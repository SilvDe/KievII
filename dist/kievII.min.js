/*! kievII v0.5.0 built on 30-08-2013 */
!function(){var a={};a.extend=function(a,b){var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a,a.superclass=b.prototype,b.prototype.constructor==Object.prototype.constructor&&(b.prototype.constructor=b)},a.clone=function(a){var b;if(null===a||"object"!=typeof a)return a;if(a instanceof Date)return b=new Date,b.setTime(a.getTime()),b;if(a instanceof Array){b=[];for(var c=0,d=a.length;d>c;++c)b[c]=clone(a[c]);return b}if(a instanceof Object){b={};for(var e in a)a.hasOwnProperty(e)&&(b[e]=clone(a[e]));return b}throw new Error("Unable to copy obj! Its type isn't supported.")},a.mergeObject=function(a,b){var c={};if(!b)return a;for(var d in a)c[d]=d in b?b[d]:a[d];return c},a.UIElement=function(a){arguments.length&&this.getready(a)},a.UIElement.prototype.getready=function(a){if(this.ID=a.ID,this.isListening=a.isListening,"undefined"==typeof this.isListening&&(this.isListening=!0),"boolean"!=typeof this.isListening)throw"Property isListening for element "+this.ID+" is not boolean "+this.isListening;if(this.isVisible=a.isVisible,"undefined"==typeof this.isVisible&&(this.isVisible=!0),"boolean"!=typeof this.isVisible)throw"Property isVisible for element "+this.ID+" is not boolean "+this.isVisible;this.xOrigin=a.left,this.yOrigin=a.top,this.ROILeft="undefined"!=typeof a.ROILeft?a.ROILeft:this.xOrigin,this.ROITop="undefined"!=typeof a.ROITop?a.ROITop:this.yOrigin,this.ROIWidth=a.ROIWidth,this.ROIHeight=a.ROIHeight,this.values={},this.transparency=a.transparency||1,this.objParms=a.objParms,"undefined"!=typeof a&&(this.onValueSet=a.onValueSet)},a.UIElement.prototype.isInROI=function(){return!1},a.UIElement.prototype.getValues=function(){var a,b=[];for(a in this.values)this.values.hasOwnProperty(a)&&b.push(a);return b},a.UIElement.prototype.getXCoord=function(){return this.xOrigin},a.UIElement.prototype.getYCoord=function(){return this.yOrigin},a.UIElement.prototype.getWidth=function(){return this.width},a.UIElement.prototype.getHeight=function(){return this.height},a.UIElement.prototype.setHeight=function(a){this.height=a,"undefined"==typeof this.ROIHeight&&(this.ROIHeight=a)},a.UIElement.prototype.setWidth=function(a){this.width=a,"undefined"==typeof this.ROIWidth&&(this.ROIWidth=a)},a.UIElement.prototype.getValue=function(a){if("undefined"==typeof this.values[a])throw new Error("Slot "+a+" not present or value undefined");return this.values[a]},a.UIElement.prototype.setValue=function(a,b){if("undefined"==typeof this.values[a])throw new Error("Slot "+a+" not present or value undefined");b!==this.values[a]&&(this.values[a]=b)},a.UIElement.prototype.setListening=function(a){if("boolean"!=typeof a)throw"Property isListening for element "+this.ID+" is not boolean "+a;this.isListening=a},a.UIElement.prototype.getListening=function(){return this.isListening},a.UIElement.prototype.refresh=function(a){var b="call_"+a.type;if("function"!=typeof this[b])throw"Element "+this.ID+" "+b+" is not a function. Its type is "+typeof this[b];this[b](a)},a.UIElement.prototype.call_CANVAS2D=function(a){var b="refresh_"+a.type;if(a.context.save(),a.context.globalAlpha=this.transparency,"function"!=typeof this[b])throw"Element "+this.ID+" "+b+" is not a function. Its type is "+typeof this[b];this[b](a),a.context.restore()},a.UIElement.prototype.getID=function(){return this.ID},a.UIElement.prototype.setDrawClass=function(a){this.drawClass=a},a.UIElement.prototype.setVisible=function(a){if("boolean"!=typeof a)throw"Property isVisible for element "+this.ID+" is not boolean "+a;this.isVisible=a},a.UIElement.prototype.getVisible=function(){return this.isVisible},a.UIElement.prototype.setGraphicWrapper=function(a){this.wrapper=a},a.UI=function(b,c){this.getEventPosition=function(a,b){var c,d,e=parseInt(document.defaultView.getComputedStyle(b,null).paddingLeft,10)||0,f=parseInt(document.defaultView.getComputedStyle(b,null).paddingTop,10)||0,g=parseInt(document.defaultView.getComputedStyle(b,null).borderLeftWidth,10)||0,h=parseInt(document.defaultView.getComputedStyle(b,null).borderTopWidth,10)||0,i=document.body.parentNode,j=i.offsetTop,k=i.offsetLeft,l=b,m=0,n=0;if("undefined"!=typeof l.offsetParent)do m+=l.offsetLeft,n+=l.offsetTop;while(l=l.offsetParent);m+=e+g+k,n+=f+h+j,c=a.pageX-m,d=a.pageY-n;var o=parseInt(document.defaultView.getComputedStyle(b,null).getPropertyValue("width"),10)||0,p=parseInt(document.defaultView.getComputedStyle(b,null).getPropertyValue("height"),10)||0,q=b.getAttribute("width"),r=b.getAttribute("height"),s=q/o,t=r/p;return c*=s,d*=t,{x:c,y:d}},this.onMouseEvent=function(){var a=this;return function(b){var c=b.type,d=a.getEventPosition(b,a.domElement);console.log("About to notify a mouse event of type",c),a.elementsNotifyEvent(d.x,d.y,c)}},this.onHammerEvent=function(){var a=this;return function(b){var c=b.gesture.srcEvent,d=b.type,e=a.getEventPosition(c,a.domElement,b);console.log("About to notify an Hammer event of type",d),a.elementsNotifyEvent(e.x,e.y,d)}},this.elementsNotifyEvent=function(a,b,c){for(var d=this.zMax;d>=this.zMin;d-=1)if("undefined"!=typeof this.zArray[d])for(var e=this.zArray[d].length-1;e>=0;e-=1)if(this.zArray[d][e].getListening()&&"function"==typeof this.zArray[d][e][c]){var f=this.zArray[d][e][c](a,b);if("undefined"!=typeof f){if(f instanceof Array)for(var g=0;g<f.length;g+=1)this.setValue({elementID:this.zArray[d][e].ID,slot:f[g].slot,value:f[g].value});else this.setValue({elementID:this.zArray[d][e].ID,slot:f.slot,value:f.value});if(this.breakOnFirstEvent===!0)return}}};var d=b.eventTarget||b.target,e=b.renderTarget||b.target;if(this.domElement=d,"undefined"==typeof a.Hammer)throw"Hammer.js needed!";this.hammer=new a.Hammer(this.domElement,{drag_min_distance:2});var f=this.onHammerEvent();this.hammer.on("dragstart drag dragend swipe tap doubletap hold transformstart transform transformend touch release",f),this.domElement.addEventListener("mouseover",this.onMouseEvent(),!0),this.domElement.addEventListener("mouseout",this.onMouseEvent(),!0),this.elements={},this.connections={},this.zArray=[],this.engine=a.ENGINE.engineFactory(b.type,{target:e}),"undefined"!=typeof c&&(this.breakOnFirstEvent=c.breakOnFirstEvent||!1),this.addElement=function(a,b){if("undefined"!=typeof this.elements[a.ID])throw new Error("Conflicting / Duplicated ID in UI: "+a.ID+" (IDs are identifiers and should be unique)");var c=0;if("undefined"!=typeof b&&"undefined"!=typeof b.zIndex&&(c=b.zIndex),0>c||"number"!=typeof c)throw new Error("zIndex "+c+" invalid");this.elements[a.ID]={element:a,zIndex:c},"undefined"==typeof this.zArray[c]&&(this.zArray[c]=[]),this.zArray[c].push(this.elements[a.ID].element),("undefined"==typeof this.zMin||this.zMin>c)&&(this.zMin=c),("undefined"==typeof this.zMax||this.zMax<c)&&(this.zMax=c)},this.removeElement=function(a){if("undefined"!=typeof this.elements[a]){for(var b=this.elements[a].zIndex,c=this.zArray[b],d=0;d<c.length;d+=1)if(c[d].ID===a){c.splice(d,1);break}delete this.elements[a]}},this.isElement=function(a){return"undefined"!=typeof this.elements[a]},this.setZIndex=function(a,b){if("undefined"==typeof this.elements[a])throw"Could not find element ID: "+a;var c=this.elements[a].zIndex;if(c!==b){"undefined"==typeof this.zArray[b]&&(this.zArray[b]=[]),("undefined"==typeof this.zMin||this.zMin>b)&&(this.zMin=b),("undefined"==typeof this.zMax||this.zMax<b)&&(this.zMax=b);for(var d=this.zArray[c],e=this.zArray[b],f=0;f<d.length;f+=1)if(d[f].ID===a){d.splice(f,1);break}e.push(this.elements[a].element),this.elements[a].zIndex=b}},this.getZIndex=function(a){if("undefined"!=typeof this.elements[a])return this.elements[a].zIndex;throw"Could not find element ID: "+a},this.setProp=function(a,b,c){if("undefined"==typeof this.elements[a])throw"Could not find ID: "+a+" property: "+b;this.elements[a].element[b]=c},this.getProp=function(a,b){if("undefined"!=typeof this.elements[a])return this.elements[a].element[b];throw"Could not find ID: "+a+" property: "+b},this.getElement=function(a){return this.elements[a].element},this.connectSlots=function(a,b,c,d,e){if("undefined"==typeof this.elements[a]||"undefined"==typeof this.elements[c])throw new Error("Element "+a+" or "+c+" not present.");if("undefined"==typeof this.elements[a].element.values[b]||"undefined"==typeof this.elements[c].element.values[d])throw new Error("Slot "+b+" or "+d+" not present.");var f={recvElement:c,recvSlot:d};"undefined"!=typeof e&&("function"==typeof e.callback&&(f.callback=e.callback),f.cascade=!0,"undefined"!=typeof e.cascade&&(f.cascade=e.cascade)),"undefined"==typeof this.connections[a]&&(this.connections[a]={}),"undefined"==typeof this.connections[a][b]&&(this.connections[a][b]=[]),this.connections[a][b].push(f)},this.resetSlots=function(){this.connections={}},this.unconnectSlots=function(){},this.resetSenderSlot=function(){},this.setValue=function(a){var b,c,d,e,f,g,h,i,j,k,l=[],m=1e3;if("undefined"==typeof a.elementID)throw"ID is undefined";if(f=a.elementID,"undefined"==typeof a.value)throw"value is undefined";if(g=a.value,i="undefined"==typeof a.fireCallback?!0:a.fireCallback,j=a.history,"undefined"==typeof this.elements[f])throw new Error("Element "+f+" not present.");if("undefined"==typeof a.slot){if(h=this.elements[f].element.defaultSlot,"undefined"==typeof h)throw"Default slot is undefined!"}else h=a.slot;if("undefined"!=typeof j){l=j;for(var n=0;n<l.length;n+=1){if(l.length>m)throw new Error("Recursion exceeded");if(l[n].element===f&&l[n].slot===h)return}}if(this.elements[f].element.setValue(h,g),"function"==typeof this.elements[f].element.onValueSet&&i!==!1&&this.elements[f].element.onValueSet(h,this.elements[f].element.values[h],f),l.push({element:f,slot:h}),"undefined"!=typeof this.connections[f]&&"undefined"!=typeof this.connections[f][h])for(e in this.connections[f][h])if(this.connections[f][h].hasOwnProperty(e)){if(b=this.connections[f][h][e],c=b.recvElement,d=b.recvSlot,"function"==typeof b.callback){var o={sender:f,sendSlot:h,recv:c,recvSlot:d,ui:this};k=b.callback(g,o)}var p;p=b.cascade!==!1,this.setValue({elementID:c,slot:d,value:k,history:l,fireCallback:p})}},this.hideElement=function(a){var b;if("undefined"==typeof this.elements[a])throw new Error("Element "+a+" not present.");b=this.elements[a].element.getVisible(),b===!0&&(this.elements[a].element.setVisible(!1),this.elements[a].element.setListening(!1))},this.unhideElement=function(a){var b;if("undefined"==typeof this.elements[a])throw new Error("Element "+a+" not present.");b=this.elements[a].element.getVisible(),b===!1&&(this.elements[a].element.setVisible(!0),this.elements[a].element.setListening(!0))},this.setHidden=function(a,b){this.setVisible(a,!b)},this.setVisible=function(a,b){var c;if("undefined"==typeof this.elements[a])throw new Error("Element "+a+" not present.");c=this.elements[a].element.getVisible(),c!==b&&(this.elements[a].element.setVisible(b),this.elements[a].element.setListening(b))},this.setListening=function(a,b){var c;if("undefined"==typeof this.elements[a])throw new Error("Element "+a+" not present.");c=this.elements[a].element.getListening(),c!==b&&this.elements[a].element.setListening(b)},this.refreshZ=function(a){for(var b=a,c=this.zArray.length;c>b;b+=1)if("object"==typeof this.zArray[b])for(var d=0,e=this.zArray[b].length;e>d;d+=1)this.zArray[b][d].getVisible()===!0&&this.zArray[b][d].refresh(this.engine)},this.refresh=function(a){a!==!1&&this.reset(),"undefined"!=typeof this.zMin&&this.refreshZ(this.zMin)},this.reset=function(){this.engine.reset()}},a.Area=function(a){arguments.length&&this.getready(a)},a.extend(a.Area,a.UIElement),a.Area.prototype.getready=function(b){a.Area.superclass.getready.call(this,b),this.values={width:0,height:0,selected:[],xOffset:0,yOffset:0,doubletap:[],held:[]},this.defaultSlot="height",this.color=b.color||"black",this.borderColor=b.borderColor||"green",this.proximity=Math.floor(b.proximity)||10,this.thickness=Math.floor(b.thickness)||this.proximity,0===b.thickness&&(this.thickness=0),this.borders=b.borders||{top:!0,bottom:!0,right:!0,left:!0},this.dragBorders=b.dragBorders||{top:!0,bottom:!0,right:!0,left:!0},this.move=b.move||"all",this.xMonotone=b.xMonotone||!1,this.yMonotone=b.yMonotone||!1;var c=b.height||0,d=b.width||0;this.values.width=d,this.values.height=c;var e=b.left||0,f=b.top||0;this.values.xOffset=e,this.values.yOffset=f},a.Area.prototype.isInArea=function(a,b){var c=!1,d=!1;return this.values.width>0?a>this.values.xOffset&&a<this.values.xOffset+this.values.width&&(c=!0):a<this.values.xOffset&&a>this.values.xOffset+this.values.width&&(c=!0),this.values.height>0?b>this.values.yOffset&&b<this.values.height+this.values.yOffset&&(d=!0):b<this.values.yOffset&&b>this.values.height+this.values.yOffset&&(d=!0),c&&d},a.Area.prototype.tap=a.Area.prototype.dragstart=function(a,b){var c=this.values.xOffset-this.proximity,d=this.values.xOffset+this.proximity,e=this.values.xOffset+this.values.width-this.proximity,f=this.values.xOffset+this.values.width+this.proximity,g=this.values.height+this.values.yOffset+this.proximity,h=this.values.height+this.values.yOffset-this.proximity,i=this.values.yOffset+this.proximity,j=this.values.yOffset-this.proximity;a>c&&d>a&&this.dragBorders.left===!0&&(this.leftSide=!0,console.log("Left side click detected")),a>e&&f>a&&this.dragBorders.right===!0&&(this.rightSide=!0,console.log("Right side click detected")),b>h&&g>b&&this.dragBorders.bottom===!0&&(this.bottomSide=!0,console.log("Bottom side click detected")),b>j&&i>b&&this.dragBorders.top===!0&&(this.topSide=!0,console.log("Top side click detected")),this.isInArea(a,b)?(console.log("clicked inside!"),this.inside=!0,this.startPoint=[a,b]):this.inside=!1},a.Area.prototype.drag=function(a,b){var c,d,e=[];if(this.leftSide&&this.borders.left){c=this.values.width-(a-this.values.xOffset);var f=a;this.xMonotone&&0>c&&(c=0,f=this.values.xOffset),e.push({slot:"width",value:c}),e.push({slot:"xOffset",value:f})}if(this.rightSide&&this.borders.right&&!this.leftSide&&(c=a-this.values.xOffset,this.xMonotone&&0>c&&(c=0),e.push({slot:"width",value:c})),this.bottomSide&&this.borders.bottom&&(d=this.values.height+(b-(this.values.yOffset+this.values.height)),this.yMonotone&&0>d&&(d=0),e.push({slot:"height",value:d})),this.topSide&&this.borders.top&&!this.bottomSide){d=this.values.height+(this.values.yOffset-b);var g=b;this.yMonotone&&0>d&&(d=0,g=this.values.yOffset),e.push({slot:"yOffset",value:g}),e.push({slot:"height",value:d})}if(e.length>0)return e;if(this.inside&&"none"!==this.move){var h=a-this.startPoint[0],i=b-this.startPoint[1];if(this.startPoint=[a,b],"all"===this.move)return[{slot:"xOffset",value:this.values.xOffset+h},{slot:"yOffset",value:this.values.yOffset+i}];if("x"===this.move)return{slot:"xOffset",value:this.values.xOffset+h};if("y"===this.move)return{slot:"yOffset",value:this.values.yOffset+i}}return void 0},a.Area.prototype.dragend=function(a,b){var c;return this.leftSide=this.rightSide=this.bottomSide=this.topSide=!1,this.inside&&this.isInArea(a,b)&&(c={slot:"selected",value:[a,b]}),this.inside=!1,c},a.Area.prototype.hold=function(a,b){return this.isInArea(a,b)?{slot:"held",value:[a,b]}:void 0},a.Area.prototype.doubletap=function(a,b){return this.isInArea(a,b)?{slot:"doubletap",value:[a,b]}:void 0},a.Area.prototype.setValue=function(b,c){a.Area.superclass.setValue.call(this,b,c)},a.Area.prototype.refresh_CANVAS2D=function(a){if(this.isVisible===!0){a.context.fillStyle=this.color,a.context.strokeStyle=this.borderColor,a.context.lineWidth=this.thickness;var b=Math.floor(this.thickness/2);a.context.fillRect(this.xOrigin+this.values.xOffset+b,this.values.yOffset+b,this.values.width-2*b,this.values.height-2*b),this.thickness>0&&a.context.strokeRect(this.xOrigin+this.values.xOffset,this.values.yOffset,this.values.width,this.values.height)}},a.Area.prototype.getXCoord=function(){return this.values.xOrigin},a.Area.prototype.getYCoord=function(){return this.values.yOrigin},a.Area.prototype.getWidth=function(){return this.values.width},a.Area.prototype.getHeight=function(){return this.values.height},a.Area.prototype.setHeight=function(a){this.values.height=a,"undefined"==typeof this.ROIHeight&&(this.ROIHeight=a)},a.Area.prototype.setWidth=function(a){this.values.width=a,"undefined"==typeof this.ROIWidth&&(this.ROIWidth=a)},a.Curve=function(a){arguments.length&&this.getready(a)},a.extend(a.Curve,a.UIElement),a.Curve.prototype.getready=function(b){switch(a.Curve.superclass.getready.call(this,b),this.values={points:[],selected:[],held:[],doubletap_c:[],doubletap_h:[]},this.defaultSlot="points",this.setWidth(b.width),this.setHeight(b.height),this.curveType=b.curveType||"bezier",this.thickness=b.thickness||2,this.curveColor=b.curveColor||"black",this.helperColor=b.helperColor||"#CCCCCC",this.handleColor=b.handleColor||"red",this.curveLabels="boolean"==typeof b.curveLabels?b.curveLabels:!1,this.terminalPointStyle=b.terminalPointStyle||"rect",this.paintTerminalPoints=b.paintTerminalPoints||"all",this.midPointStyle=b.midPointStyle||"circle",this.terminalPointSize=b.terminalPointSize||16,this.midPointSize=b.midPointSize||8,this.terminalPointColor=b.terminalPointColor||this.handleColor,this.midPointColor=b.midPointColor||this.handleColor,this.terminalPointFill=b.terminalPointFill||null,this.midPointFill=b.midPointFill||null,this.xMonotone=b.xMonotone||!1,this.handleSize=b.handleSize||this.terminalPointSize>this.midPointSize?this.terminalPointSize:this.midPointSize,this.handleClicked=null,this.supportPoints=[],this.selectStart=!1,this.whereHappened=[],b.curveType){case"bezier":if(0!==b.points.length%2||b.points.length<4)throw"Incorrect number of points "+b.points.length;break;case"halfcosine":case"smooth":case"linear":if(4!==b.points.length)throw"Incorrect number of points "+b.points.length;break;default:throw"Unknown curve type "+b.curveType}for(var c=[],d=0;d<b.points.length;d+=2)c.push([b.points[d],b.points[d+1]]);this.values.points=c},a.Curve.prototype.isInCurve=function(a,b){for(var c=0;c<this.supportPoints.length;c+=1)if(a>this.supportPoints[c][0]-this.thickness&&a<this.supportPoints[c][0]+this.thickness&&b>this.supportPoints[c][1]-this.thickness&&b<this.supportPoints[c][1]+this.thickness)return!0;return!1},a.Curve.prototype.isInHandle=function(a,b){for(var c=this.values.points,d=0;d<c.length;d+=1)if(a>c[d][0]-this.handleSize&&a<c[d][0]+this.handleSize&&b>c[d][1]-this.handleSize&&b<c[d][1]+this.handleSize)return d;return null},a.Curve.prototype.isInROI=function(a,b){return a>this.ROILeft&&b>this.ROITop&&a<this.ROILeft+this.ROIWidth&&b<this.ROITop+this.ROIHeight?!0:!1},a.Curve.prototype.touch=a.Curve.prototype.dragstart=function(a,b){var c=this.values.points;if(this.isInROI(a,b)){var d;if(null!==(d=this.isInHandle(a,b))&&(this.handleClicked=d,0===d||d===c.length-1))return;if(this.isInCurve(a,b))return this.selectStart=!0,void 0}},a.Curve.prototype.xMonotoneFunc=function(a){a[0][0]>a[a.length-1][0]&&(a[0][0]>this.values.points[0][0]?a[0][0]=a[a.length-1][0]:a[a.length-1][0]=a[0][0])},a.Curve.prototype.drag=function(b,c){var d,e={};return null!==this.handleClicked?(d=a.GenericUtils.clone(this.values.points),this.isInROI(b,c)?(this.triggered=!1,d[this.handleClicked][0]=b,d[this.handleClicked][1]=c):(d[this.handleClicked][0]=b,d[this.handleClicked][1]=c,b>this.ROILeft+this.ROIWidth&&(d[this.handleClicked][0]=this.ROILeft+this.ROIWidth),b<this.ROILeft&&(d[this.handleClicked][0]=this.ROILeft),c>this.ROITop+this.ROIHeight&&(d[this.handleClicked][1]=this.ROITop+this.ROIHeight),c<this.ROITop&&(d[this.handleClicked][1]=this.ROITop)),this.whereHappened=[d[this.handleClicked][0],d[this.handleClicked][1]],e={slot:"points",value:d}):void 0},a.Curve.prototype.dragend=a.Curve.prototype.swipe=function(a,b){if(!(0>a&&0>b)){var c=this.drag(a,b);return this.handleClicked=null,c}},a.Curve.prototype.release=function(a,b){return this.handleClicked=null,this.selectStart===!0&&this.isInCurve(a,b)?(this.selectStart=!1,console.log("selected curve!",this),{slot:"selected",value:[a,b]}):void 0},a.Curve.prototype.hold=function(a,b){if(this.isInROI(a,b)&&this.isInCurve(a,b)){var c={slot:"held",value:[a,b]};return c}return void 0},a.Curve.prototype.doubletap=function(a,b){if(this.isInROI(a,b)){var c;if(null!==(c=this.isInHandle(a,b)))return console.log("duble tapped handle!",this),{slot:"doubletap_h",value:[[a,b],c]};if(this.isInCurve(a,b))return console.log("duble tapped curve!",this),{slot:"doubletap_c",value:[a,b]}}return void 0},a.Curve.prototype.setValue=function(b,c){var d=!0;if("points"===b)for(var e=this.values[b],f=0;f<c.length;f+=1){for(var g=0;g<c.length;g+=1)if(c[f][g]!==e[f][g]){d=!1;break}if(d===!1)break}else d=!1;this.xMonotone&&this.xMonotoneFunc(c),d||a.Curve.superclass.setValue.call(this,b,c)},a.Curve.prototype.refresh_CANVAS2D=function(a){if(this.isVisible===!0){var b=a.context,c={thickness:this.thickness,curveColor:this.curveColor,helperColor:this.helperColor,handleColor:this.handleColor,handleSize:this.handleSize,curveLabels:this.curveLabels};this.genericCurve(this.values.points,this.curveType),this.paintCurve(b),this.paintPoints(b,this.values.points,c)}},a.Curve.prototype.getCurvePoints=function(a){for(var b=1/a,c=[],d=0;1>=d;d+=b){var e=this[this.curveType].P(d,this.values.points);c.push(e)}return c},a.Curve.prototype.getCurveYPoints=function(a,b){"undefined"==typeof b&&(b=1);for(var c=1/a,d=[],e=0;1>=e;e+=c){var f=this[this.curveType].P(e,this.values.points)[1]*b;d.push(f)}return d},a.Curve.prototype.getPoint=function(a){return this.supportPoints[a]},a.Curve.prototype.getnumPoints=function(){return this.supportPoints.length},a.Curve.prototype.halfcosine={P:function(a,b){var c=(1-Math.cos(a*Math.PI))/2,d=[0,0];return d[0]=b[0][0]+(b[1][0]-b[0][0])*a,d[1]=b[0][1]*(1-c)+b[1][1]*c,d}},a.Curve.prototype.smooth={P:function(a,b){var c=a*a*(3-2*a),d=[0,0];return d[0]=b[0][0]+(b[1][0]-b[0][0])*a,d[1]=b[0][1]+c*(b[1][1]-b[0][1]),d}},a.Curve.prototype.linear={P:function(a,b){var c=[0,0];return c[0]=b[0][0]+(b[1][0]-b[0][0])*a,c[1]=b[0][1]*(1-a)+b[1][1]*a,c}},a.Curve.prototype.cubic={P:function(a,b){var c=[0,0];c[0]=b[0][0]+(b[3][0]-b[0][0])*a;var d=a,e=a*a,f=b[3][1]-b[2][1]-b[0][1]+b[1][1],g=b[0][1]-b[1][1]-f,h=b[2][1]-b[0][1],i=b[1][1];return c[1]=f*d*e+g*e+h*d+i,c}},a.Curve.prototype.catmull={P:function(a,b){var c=[0,0];c[0]=b[0][0]+(b[3][0]-b[0][0])*a;var d=a,e=a*a,f=b[0][1],g=b[1][1],h=b[2][1],i=b[3][1],j=-.5*f+1.5*g-1.5*h+.5*i,k=f-2.5*g+2*h-.5*i,l=-.5*f+.5*h,m=g;return c[1]=j*d*e+k*e+l*d+m,c}},a.Curve.prototype.hermite={P:function(a,b,c,d){var e=[0,0];e[0]=b[0][0]+(b[3][0]-b[0][0])*a;var f,g,h,i,j,k,l,m,n=d||0,o=c||0,p=a,q=b[0][1],r=b[1][1],s=b[2][1],t=b[3][1];return h=p*p,i=h*p,f=(r-q)*(1+n)*(1-o)/2,f+=(s-r)*(1-n)*(1-o)/2,g=(s-r)*(1+n)*(1-o)/2,g+=(t-s)*(1-n)*(1-o)/2,j=2*i-3*h+1,k=i-2*h+p,l=i-h,m=-2*i+3*h,e[1]=j*r+k*f+l*g+m*s,e}},a.Curve.prototype.bezier={P:function(a,b){function c(a,b,c){var e=d;return"function"==typeof fact_lookup&&(e=fact_lookup),e(b)/(e(a)*e(b-a))*Math.pow(c,a)*Math.pow(1-c,b-a)}for(var d=function(a){for(var b=1,c=2;a>=c;c++)b*=c;return b},e=[0,0],f=b.length-1,g=0;f>=g;g++)e[0]+=b[g][0]*c(g,f,a),e[1]+=b[g][1]*c(g,f,a);return e}},a.Curve.prototype.genericCurve=function(a,b){function c(a,b){return Math.sqrt(Math.pow(a[0]-b[0],2)+Math.pow(a[1]-b[1],2))}function d(a){for(var b=0,d=0;d<a.length-1;d++)b+=c(a[d],a[d+1]);var e=1/b;return e}function e(a,b){for(var c=d(a),e=[],f=0;1>=f;f+=c){var g=b.P(f,a);e.push(g)}return e}this.supportPoints=e(a,this[b])},a.Curve.prototype.paintHandle=function(a,b,c){c===!0?this.paintPoint(a,b,this.terminalPointStyle,this.terminalPointFill,this.terminalPointColor,this.terminalPointSize):this.paintPoint(a,b,this.midPointStyle,this.midPointFill,this.midPointColor,this.midPointSize)},a.Curve.prototype.paintPoint=function(a,b,c,d,e,f){if("rect"===c)a.save(),a.strokeStyle=e,a.lineWidth=Math.round(f/5),a.strokeRect(b[0]-Math.round(f/2),b[1]-Math.round(f/2),f,f),null!==d&&(a.fillStyle=d,a.fillRect(b[0]-Math.ceil(f/2)+Math.floor(a.lineWidth/2),b[1]-Math.ceil(f/2)+Math.floor(a.lineWidth/2),f-a.lineWidth+1,f-a.lineWidth+1)),a.restore();else if("circle"===c)a.save(),a.beginPath(),a.strokeStyle=e,a.lineWidth=Math.round(f/5),a.arc(b[0],b[1],f,0,2*Math.PI,!1),null!==d&&(a.fillStyle=d,a.fill()),a.stroke(),a.restore();else if("none"!==c)throw"Unknown handle style: "+c},a.Curve.prototype.paintPoints=function(a){var b,c=this.values.points;for(a.save(),a.strokeStyle=this.helperColor,a.beginPath(),a.moveTo(c[0][0],c[0][1]),b=1;b<c.length;b++)a.lineTo(c[b][0],c[b][1]);for(a.stroke(),b=0;b<c.length;b++){var d=!1;(0===b||b===c.length-1)&&(d=!0);var e=this.paintTerminalPoints;d===!0?("all"===e||"first"===e&&0===b||"last"===e&&b===c.length-1)&&(this.paintHandle(a,c[b],d),this.curveLabels&&a.fillText(this.ID+" ("+b+")"+" ["+c[b][0]+","+c[b][1]+"]",c[b][0],c[b][1]-10)):(this.paintHandle(a,c[b],d),this.curveLabels&&a.fillText(this.ID+" ("+b+")"+" ["+c[b][0]+","+c[b][1]+"]",c[b][0],c[b][1]-10)),a.restore()}},a.Curve.prototype.paintCurve=function(a){var b=this.supportPoints,c=this.thickness,d=this.curveColor;a.save(),a.lineWidth=c,a.strokeStyle=d,a.beginPath(),a.moveTo(b[0][0],b[0][1]);for(var e=1;e<b.length;e++)a.lineTo(b[e][0],b[e][1]);a.stroke(),a.restore()},a.Bar=function(a){arguments.length&&this.getready(a)},a.extend(a.Bar,a.UIElement),a.Bar.prototype.getready=function(b){a.Bar.superclass.getready.call(this,b),this.values={barPos:[],dragStart:[],dragEnd:[]},this.defaultSlot="barPos",this.setWidth(b.width),this.setHeight(b.height),this.orientation=b.orientation||0,this.barColor=b.barColor||"black",this.thickness=b.thickness||1},a.Bar.prototype.isInROI=function(a,b){return a>this.ROILeft&&b>this.ROITop&&a<this.ROILeft+this.ROIWidth&&b<this.ROITop+this.ROIHeight?!0:!1},a.Bar.prototype.isInROIX=function(a){return a>this.ROILeft&&a<this.ROILeft+this.ROIWidth},a.Bar.prototype.isInROIY=function(a){return a>this.ROITop&&a<this.ROITop+this.ROIHeight},a.Bar.prototype.commonDrag=function(a,b){var c,d=this.values.barPos;if(0===this.orientation){if(!this.isInROIY(b))return void 0;c=[a-this.xOrigin,d[1]],c[0]>this.width&&(c[0]=this.width),c[0]<0&&(c[0]=0)}else if(1===this.orientation){if(!this.isInROIY(a))return void 0;c=[d[0],b-this.yOrigin],c[1]>this.height&&(c[1]=this.height),c[1]<0&&(c[1]=0)}return c},a.Bar.prototype.touch=function(a,b){if(this.isInROI(a,b)){this.started=!0;var c=this.commonDrag(a,b);if("undefined"!=typeof c)return{slot:"barPos",value:c}}return void 0},a.Bar.prototype.drag=function(a,b){if(this.started){var c=this.commonDrag(a,b);if("undefined"!=typeof c)return{slot:"barPos",value:c}}return void 0},a.Bar.prototype.dragend=a.Bar.prototype.swipe=function(a,b){if(this.started){this.started=!1;var c=this.commonDrag(a,b);if("undefined"!=typeof c)return[{slot:"barPos",value:c},{slot:"dragEnd",value:[a-this.xOrigin,b-this.yOrigin]}]}return void 0},a.Bar.prototype.dragstart=function(a,b){return this.isInROI(a,b)?{slot:"dragStart",value:[a-this.xOrigin,b-this.yOrigin]}:void 0},a.Bar.prototype.setValue=function(a,b){console.log("Setting "+a+" to "+b),"barPos"==a?(b[0]<=this.width&&(this.values.barPos[0]=b[0]),b[1]<=this.height&&(this.values.barPos[1]=b[1])):this.values[a]=b},a.Bar.prototype.refresh_CANVAS2D=function(a){if(this.isVisible===!0){var b=a.context;if(b.lineWidth=this.thickness,b.strokeStyle=this.barColor,b.beginPath(),0===this.orientation){var c=this.xOrigin+this.values.barPos[0];b.moveTo(c,this.yOrigin+this.height),b.lineTo(c,this.yOrigin)}else 1===this.orientation&&(b.moveTo(this.xOrigin+this.width,this.yOrigin+this.values.barPos[1]),b.lineTo(this.xOrigin,this.yOrigin+this.values.barPos[1]));b.stroke(),b.closePath()}},a.Button=function(a){arguments.length&&this.getready(a)},a.extend(a.Button,a.UIElement),a.Button.prototype.getready=function(b){if(void 0===b)throw new Error("Error: args is undefined!");if(a.Button.superclass.getready.call(this,b),this.values={buttonvalue:0},this.defaultSlot="buttonvalue",this.triggered=!1,this.mode=b.mode||"persistent",this.imagesArray=b.imagesArray,this.imagesArray.length<1)throw new Error("Invalid images array length, "+this.imagesArray.length);this.nButtons=this.imagesArray.length;for(var c=0;c<this.nButtons;c+=1)this.setWidth(this.imagesArray[c].width),this.setHeight(this.imagesArray[c].height)},a.Button.prototype.isInROI=function(a,b){return a>=this.ROILeft&&b>=this.ROITop&&a<=this.ROILeft+this.ROIWidth&&b<=this.ROITop+this.ROIHeight?!0:!1},a.Button.prototype.touch=function(a,b){if(this.isInROI(a,b)){if(this.triggered=!0,"persistent"===this.mode)return void 0;if("immediate"===this.mode){var c=(this.values.buttonvalue+1)%this.nButtons;return{slot:"buttonvalue",value:c}}}return void 0},a.Button.prototype.release=function(a,b){var c=0,d={};if("persistent"===this.mode){if(this.triggered&&this.isInROI(a,b))return c=(this.values.buttonvalue+1)%this.nButtons,d={slot:"buttonvalue",value:c},this.triggered=!1,d}else if("immediate"===this.mode&&this.triggered)return c=(this.values.buttonvalue-1)%this.nButtons,d={slot:"buttonvalue",value:c},this.triggered=!1,d;return void 0},a.Button.prototype.mouseout=function(a,b){return"immediate"===this.mode?this.release(a,b):void 0},a.Button.prototype.setValue=function(b,c){0>c||c>this.nButtons||a.Button.superclass.setValue.call(this,b,c)},a.Button.prototype.refresh_CANVAS2D=function(a){this.isVisible===!0&&a.context.drawImage(this.imagesArray[this.values.buttonvalue],this.xOrigin,this.yOrigin)},a.Button.prototype.setStatesNumber=function(a){this.nButtons=a},a.Button.prototype.getStatesNumber=function(){return this.nButtons},a.Background=function(a){arguments.length&&this.getready(a)},a.extend(a.Background,a.UIElement),a.Background.prototype.getready=function(b){if("undefined"==typeof b)throw new Error("Error: args is undefined!");a.Background.superclass.getready.call(this,b),this.values={selected:[],held:[],doubletap:[],tap:[]},this.defaultSlot="selected",this.image=b.image,this.setWidth(this.image.width),this.setHeight(this.image.height)},a.Background.prototype.GetImage=function(){return this.image},a.Background.prototype.isInROI=function(a,b){return a>this.ROILeft&&b>this.ROITop?a<this.ROILeft+this.ROIWidth&&b<this.ROITop+this.ROIHeight:!1},a.Background.prototype.touch=function(a,b){return this.isInROI(a,b)&&(this.triggered=!0),void 0},a.Background.prototype.release=function(a,b){return this.triggered&&this.isInROI(a,b)?(this.triggered=!1,{slot:"selected",value:[a,b]}):void 0},a.Background.prototype.refresh_CANVAS2D=function(a){this.isVisible===!0&&a.context.drawImage(this.image,this.xOrigin,this.yOrigin)},a.ClickBar=function(a){arguments.length&&this.getready(a)},a.extend(a.ClickBar,a.UIElement),a.ClickBar.prototype.getready=function(b){a.ClickBar.superclass.getready.call(this,b),this.values={barvalue:null},this.prevValue=null,this.defaultSlot="barvalue",this.color=b.color||"orangered",this.lightColor=b.diffColor||"darkorange",this.lighterColor=b.prevColor||"orange",this.lightestColor=b.prevColor||"#FFBE00",this.landingHeight=b.landingHeight||20;var c=b.height||0,d=b.width||0;this.maxValue=b.maxValue||1,this.minValue=b.minValue||0,this.setWidth(d),this.setHeight(c)},a.ClickBar.prototype.isInROI=function(a,b){return console.log("y = ",b,"roitop = ",this.ROITop),a>=this.ROILeft&&b>=this.ROITop-this.landingHeight&&(console.log("1st"),a<=this.ROILeft+this.ROIWidth&&b<=this.ROITop+this.ROIHeight+this.landingHeight)?(console.log("In ROI!"),!0):!1},a.ClickBar.prototype.calculateValue=function(a,b){var c=b-this.yOrigin;console.log("heigth on click is ",c," pixels");var d=1-c/this.height;return console.log("for a value of ",d," (",c," / ",this.height,")"),d>this.maxValue&&(d=this.maxValue),d<this.minValue&&(d=this.minValue),d},a.ClickBar.prototype.touch=function(a,b){if(this.isInROI(a,b)){this.triggered=!0;var c=this.calculateValue(a,b);if(c===this.values.barvalue)return;return{slot:"barvalue",value:c}}},a.ClickBar.prototype.drag=function(a,b){if(this.isInROI(a,b)){this.triggered||(this.prevValue=this.values.barvalue,this.triggered=!0);var c=this.calculateValue(a,b);if(c===this.values.barvalue)return;
return{slot:"barvalue",value:c}}},a.ClickBar.prototype.release=function(){return this.triggered=!1,this.prevValue!==this.values.barvalue?(this.prevValue=this.values.barvalue,{slot:"barvalue",value:this.values.barvalue}):void 0},a.ClickBar.prototype.setValue=function(b,c){a.ClickBar.superclass.setValue.call(this,b,c)},a.ClickBar.prototype.refresh_CANVAS2D=function(a){this.isVisible===!0&&(this.triggered?this.values.barvalue<this.prevValue?(a.context.fillStyle=this.lightestColor,a.context.fillRect(this.xOrigin,this.yOrigin+(1-this.prevValue)*this.height,this.width,this.prevValue*this.height),a.context.fillStyle=this.lightColor,a.context.fillRect(this.xOrigin,this.yOrigin+(1-this.values.barvalue)*this.height,this.width,this.values.barvalue*this.height)):(a.context.fillStyle=this.lightColor,a.context.fillRect(this.xOrigin,this.yOrigin+(1-this.values.barvalue)*this.height,this.width,this.values.barvalue*this.height),a.context.fillStyle=this.lighterColor,a.context.fillRect(this.xOrigin,this.yOrigin+(1-this.prevValue)*this.height,this.width,this.prevValue*this.height)):(a.context.fillStyle=this.color,a.context.fillRect(this.xOrigin,this.yOrigin+(1-this.values.barvalue)*this.height,this.width,this.values.barvalue*this.height)))},a.Gauge=function(a){arguments.length&&this.getready(a)},a.extend(a.Gauge,a.UIElement),a.Gauge.prototype.getready=function(b){if("undefined"==typeof b)throw new Error("Error: args is undefined!");a.Gauge.superclass.getready.call(this,b),this.values={gaugevalue:null,midgaugevalue:null,selected:[],held:[],doubletap:[],tap:[]},this.defaultSlot="gaugevalue",this.prevValue=this.values.gaugevalue,this.setWidth(b.width),this.setHeight(b.height),this.color=b.color||["#47D147","#70DB70","#99E699"],this.bgColor=b.bgColor||"#222",this.radius=b.radius||(this.width<this.height?Math.floor(this.width/2):Math.floor(this.height/2)),this.thickness=b.thickness||(this.width<this.height?Math.floor(this.width/3):Math.floor(this.height/3))},a.Gauge.prototype.isInROI=function(){return!0},a.Gauge.prototype.calculateAngle=function(b,c){var d=this.xOrigin+this.width/2,e=this.yOrigin+this.height/2;console.log("Point is: ",b,c,"Center is: ",d,e);var f=Math.atan2(b-d,c-e);console.log("radiant atan ",f);var g=f*(180/Math.PI);return g=180-g,console.log("degree atan ",g),a.MathUtils.linearRange(0,360,0,1,Math.floor(g))},a.Gauge.prototype.touch=function(b,c){var d=a.MathUtils.distance(b,c,this.xOrigin+this.width/2,this.yOrigin+this.height/2);if(console.log("dist is, ",d," radius is ",this.radius," thickness is ",this.thickness),d>this.radius-this.thickness/2&&d<this.radius+this.thickness/2){console.log("down / tapped Inside the dial"),this.triggered=!0;var e=this.calculateAngle(b,c);return this.prevValue=this.values.gaugevalue,{slot:"gaugevalue",value:e}}return void 0},a.Gauge.prototype.drag=function(a,b){if(this.triggered){console.log("triggered mousemove");var c=this.calculateAngle(a,b);return{slot:"gaugevalue",value:c}}},a.Gauge.prototype.release=function(){return this.triggered?(this.triggered=!1,this.prevValue=this.values.gaugevalue,{slot:"gaugevalue",value:this.values.gaugevalue}):void 0},a.Gauge.prototype.setValue=function(b,c){a.Gauge.superclass.setValue.call(this,b,c)},a.Gauge.prototype.refresh_CANVAS2D=function(a){if(this.isVisible===!0){var b=a.context;b.beginPath(),this.drawGauge(b,1,this.bgColor),this.triggered?this.values.gaugevalue<=this.prevValue?(this.drawGauge(b,this.prevValue,this.color[2]),this.drawGauge(b,this.values.gaugevalue,this.color[1])):(this.drawGauge(b,this.values.gaugevalue,this.color[2]),this.drawGauge(b,this.prevValue,this.color[1])):this.drawGauge(b,this.values.gaugevalue,this.color[0])}},a.Gauge.prototype.drawGauge=function(b,c,d){var e,f;e=a.MathUtils.linearRange(0,1,0,360,c),f=e*Math.PI/180,b.beginPath(),b.strokeStyle=d,b.lineWidth=this.thickness,1===c?b.arc(this.xOrigin+this.width/2,this.yOrigin+this.height/2,this.radius,0,2*Math.PI,!1):b.arc(this.xOrigin+this.width/2,this.yOrigin+this.height/2,this.radius,-90*Math.PI/180,f-90*Math.PI/180,!1),b.stroke()},a.Grid=function(a){arguments.length&&this.getready(a)},a.extend(a.Grid,a.UIElement),a.Grid.prototype.getready=function(b){if(void 0===b)throw new Error("Error: args is undefined!");if(a.Grid.superclass.getready.call(this,b),this.setWidth(b.width),this.setHeight(b.height),this.values={selected:[]},this.defaultSlot="",this.triggered=!1,this.rows=b.rows||4,this.columns=b.columns||4,this.style=b.style||"line",this.lineColor=b.lineColor||"#eee",this.bgColor=b.bgColor||"white",this.dashArray=b.dashArray,this.lineWidth=b.lineWidth||.1,this.rows<0||this.columns<0)throw new Error("Invalid number of row / columns "+this.rows+" / "+this.columns)},a.Grid.prototype.isInROI=function(a,b){return a>=this.ROILeft&&b>=this.ROITop&&a<=this.ROILeft+this.ROIWidth&&b<=this.ROITop+this.ROIHeight?!0:!1},a.Grid.prototype.touch=function(a,b){return this.isInROI(a,b)&&(this.triggered=!0),void 0},a.Grid.prototype.release=function(a,b){return this.triggered&&this.isInROI(a,b)?(this.triggered=!1,{slot:"selected",value:[a,b]}):void 0},a.Grid.prototype.setValue=function(b,c){a.Grid.superclass.setValue.call(this,b,c)},a.Grid.prototype.refresh_CANVAS2D=function(a){if(this.isVisible===!0){var b=a.context,c=Math.floor(this.height/this.rows),d=Math.floor(this.width/this.columns);b.fillStyle=this.bgColor,b.fillRect(this.xOrigin,this.yOrigin,this.width,this.height),b.beginPath(),b.lineWidth=this.lineWidth;for(var e=this.xOrigin+0;e<this.xOrigin+this.width;e+=d)"line"===this.style?(b.moveTo(e,this.yOrigin),b.lineTo(e,this.yOrigin+this.height)):"dashed"===this.style&&b.dashedLine(e,this.yOrigin,e,this.yOrigin+this.height,this.dashArray);for(var f=this.yOrigin+0;f<this.yOrigin+this.height;f+=c)"line"===this.style?(b.moveTo(this.xOrigin,f),b.lineTo(this.xOrigin+this.width,f)):"dashed"===this.style&&b.dashedLine(this.xOrigin,f,this.xOrigin+this.width,f,this.dashArray);b.strokeStyle=this.lineColor,b.stroke(),b.closePath()}},a.Knob=function(a){arguments.length&&this.getready(a)},a.extend(a.Knob,a.UIElement),a.Knob.prototype.getready=function(b){if(void 0===b)throw new Error("Error: specArgs is undefined!");a.Knob.superclass.getready.call(this,b),this.values={knobvalue:0},this.defaultSlot="knobvalue",this.sensitivity=b.sensitivity||2e3,this.imagesArray=b.imagesArray||null,this.knobMethod=b.knobMethod||"atan",this.bottomAngularOffset=b.bottomAngularOffset;var c=0,d=0;if(this.imagesArray.length<1)throw new Error("Invalid images array length, "+this.imagesArray.length);if(1==this.imagesArray.length)c=b.tileWidth,d=b.tileHeight,this.imageNum=b.imageNum;else{this.imageNum=this.imagesArray.length;for(var e=0,f=this.imagesArray.length;f>e;e+=1)this.imagesArray[e].width>c&&(c=this.imagesArray[e].width),this.imagesArray[e].height>d&&(d=this.imagesArray[e].height)}this.setWidth(c),this.setHeight(d)},a.Knob.prototype.getImageNum=function(){return this.values.knobvalue<0||this.values.knobvalue>1?void 0:Math.round(this.values.knobvalue*(this.imageNum-1))},a.Knob.prototype.getImage=function(){var a=this.getImageNum();return this.imagesArray[a]},a.Knob.prototype.calculateAngle=function(b,c){var d=this.xOrigin+this.width/2,e=this.yOrigin+this.height/2;console.log("Point is: ",b,c,"Center is: ",d,e);var f=Math.atan2(b-d,c-e);console.log("radiant atan ",f),0>f&&(f+=2*Math.PI),console.log("radiant atan, normalized, is ",f);var g=f*(180/Math.PI);console.log("degree atan is",g),g=360-g,"undefined"!=typeof this.bottomAngularOffset&&(g=a.MathUtils.linearRange(0,360,-this.bottomAngularOffset,360+this.bottomAngularOffset,g),0>g&&(g=0),g>360&&(g=360));var h=a.MathUtils.linearRange(0,360,0,1,Math.floor(g));return console.log("value is",h),h},a.Knob.prototype.isInROI=function(a,b){return a>this.ROILeft&&b>this.ROITop&&a<this.ROILeft+this.ROIWidth&&b<this.ROITop+this.ROIHeight?!0:!1},a.Knob.prototype.touch=function(a,b){var c=this.isInROI(a,b);if(c&&(this.start_x=a,this.start_y=b,"atan"===this.knobMethod)){var d=this.calculateAngle(a,b);return{slot:"knobvalue",value:d}}return void 0},a.Knob.prototype.release=function(){return this.start_x=void 0,this.start_y=void 0,void 0},a.Knob.prototype.drag=function(a,b){var c;if("updown"===this.knobMethod){if(void 0!==this.start_x&&void 0!==this.start_y){var d,e,f;return d=b-this.start_y,e=this.values.knobvalue,f=e-d/this.sensitivity,f>1&&(f=1),0>f&&(f=0),c={slot:"knobvalue",value:f}}}else if("atan"===this.knobMethod&&void 0!==this.start_x&&void 0!==this.start_y){var g=this.calculateAngle(a,b);return c={slot:"knobvalue",value:g}}return void 0},a.Knob.prototype.setValue=function(b,c){0>c||c>1||a.Knob.superclass.setValue.call(this,b,c)},a.Knob.prototype.refresh_CANVAS2D=function(a){if(this.isVisible===!0)if(this.imagesArray.length>1){var b=this.getImageNum();a.context.drawImage(this.imagesArray[b],this.xOrigin,this.yOrigin)}else if(1==this.imagesArray.length){var c=0,d=this.height*this.getImageNum();a.context.drawImage(this.imagesArray[0],c,d,this.width,this.height,this.xOrigin,this.yOrigin,this.width,this.height)}},a.Label=function(a){arguments.length&&this.getready(a)},a.extend(a.Label,a.UIElement),a.Label.prototype.getready=function(b){a.Label.superclass.getready.call(this,b),this.values={labelvalue:""},this.defaultSlot="labelvalue",this.textColor=b.textColor||"black",this.setWidth(b.width),this.setHeight(b.height)},a.Label.prototype.isInROI=function(a,b){return a>this.ROILeft&&b>this.ROITop&&a<this.ROILeft+this.ROIWidth&&b<this.ROITop+this.ROIHeight?!0:!1},a.Label.prototype.setValue=function(b,c){a.Label.superclass.setValue.call(this,b,c)},a.Label.prototype.refresh_CANVAS2D=function(a){this.isVisible===!0&&("undefined"!=typeof this.objParms&&("undefined"!=typeof this.objParms.textBaseline&&(a.context.textBaseline=this.objParms.textBaseline),"undefined"!=typeof this.objParms.textAlign&&(a.context.textAlign=this.objParms.textAlign),"undefined"!=typeof this.objParms.font&&(a.context.font=this.objParms.font)),a.context.fillStyle=this.textColor,a.context.fillText(this.values.labelvalue,this.xOrigin,this.yOrigin))},a.RotKnob=function(a){arguments.length&&this.getready(a)},a.extend(a.RotKnob,a.UIElement),a.RotKnob.prototype.getready=function(b){if("undefined"==typeof b)throw"RotKnob constructor: args is undefined!";a.RotKnob.superclass.getready.call(this,b),this.values={knobvalue:0,realknobvalue:0},this.defaultSlot="knobvalue",this.initAngValue=void 0===b.initAngValue?0:b.initAngValue,this.moveDirection="anticlockwise"==b.moveDirection?-1:1,this.startAngValue=b.startAngValue||0,this.stopAngValue=b.stopAngValue||360,this.angSteps=b.angSteps;var c=b.sensitivity||2e3;this.sensitivity=Math.round(c/360*Math.abs(this.stopAngValue-this.startAngValue)),this.knobMethod=b.knobMethod||"atan",this.image=b.image,this.setWidth(this.image.width),this.setHeight(this.image.height),this.start_x=null,this.start_y=null},a.RotKnob.prototype.getRotateAmount=function(){if(this.values.knobvalue<0||this.values.knobvalue>1)return void 0;var a=360*this.values.knobvalue,b=360-(a*(this.startAngValue-this.stopAngValue)/360+this.stopAngValue)%360,c=(360-this.initAngValue+b)%360;return c*Math.PI/180},a.RotKnob.prototype.getRangedAmount=function(b){var c=this.stopAngValue-this.initAngValue,d=this.startAngValue-this.initAngValue;console.log("start -> end",d,c),b>this.initAngValue&&0>d&&(console.log("Angle now is",b),b=-(360-b));var e=a.MathUtils.linearRange(d,c,0,1,b);return console.log("knob value",e),0>e&&(e=0),e>1&&(e=1),e},a.RotKnob.prototype.isInROI=function(a,b){return a>this.ROILeft&&b>this.ROITop&&a<this.ROILeft+this.ROIWidth&&b<this.ROITop+this.ROIHeight?!0:!1},a.RotKnob.prototype.calculateAngle=function(a,b){var c=this.xOrigin+this.width/2,d=this.yOrigin+this.height/2;console.log("Point is: ",a,b,"Center is: ",c,d);var e=Math.atan2(a-c,b-d);console.log("radiant atan ",e);var f=e*(180/Math.PI);f=180-f;var g=f-this.initAngValue;0>g&&(g=360+g);var h=(f-this.initAngValue)%360;return console.log("degreetan -> offset",f,g,h),this.getRangedAmount(Math.floor(g))},a.RotKnob.prototype.touch=function(a,b){var c=this.isInROI(a,b);if(c&&(this.start_x=a,this.start_y=b,"atan"===this.knobMethod)){var d=this.calculateAngle(a,b);return{slot:"knobvalue",value:d}}return void 0},a.RotKnob.prototype.release=function(){return this.start_x=null,this.start_y=null,void 0},a.RotKnob.prototype.drag=function(a,b){var c;if("updown"===this.knobMethod){if(null!==this.start_x&&null!==this.start_y){var d,e,f;return d=b-this.start_y,e=this.values.realknobvalue,f=e-d/this.sensitivity*this.moveDirection,f>1&&(f=1),0>f&&(f=0),c={slot:"knobvalue",value:f}}}else if("atan"===this.knobMethod&&this.isInROI(a,b)&&null!==this.start_x&&null!==this.start_y){var g=this.calculateAngle(a,b);return c={slot:"knobvalue",value:g}}return void 0},a.RotKnob.prototype.setValue=function(b,c){var d;if(!(0>c||c>1)){if(void 0===this.values[b])throw new Error("Slot "+b+" not present or value undefined");if(c!==this.values[b]&&c!==this.values["real"+b]){if(this.values["real"+b]=c,void 0!==this.angSteps){var e=1/this.angSteps;if(d=Math.floor(c/e)*e,d===this.values[b])return}else d=c;console.log("Value is: ",d),a.RotKnob.superclass.setValue.call(this,b,d)}}},a.RotKnob.prototype.refresh_CANVAS2D=function(b){if(this.isVisible===!0){var c=this.getRotateAmount();a.CanvasUtils.drawRotate(b.context,{image:this.image,x:this.xOrigin,y:this.yOrigin,rot:c})}},a.Slider=function(a){arguments.length&&this.getready(a)},a.extend(a.Slider,a.UIElement),a.Slider.prototype.getready=function(b){if("undefined"==typeof b)throw"Slider error: args is undefined!";a.Slider.superclass.getready.call(this,b),this.values={slidervalue:0},this.defaultSlot="slidervalue",this.width=0,this.height=0,this.sliderImage=b.sliderImg,this.knobImage=b.knobImg,this.type=b.type,"horizontal"!==this.type&&"vertical"!==this.type&&(this.type="vertical"),this.calculateDimensions()},a.Slider.prototype.getKnobPosition=function(){var a;if(this.values.slidervalue<0||this.values.slidervalue>1)return void 0;switch(this.type){case"horizontal":a=Math.round(this.values.slidervalue*this.width+this.zeroLimit);break;case"vertical":a=Math.round(this.values.slidervalue*this.height+this.zeroLimit);break;default:throw new Error("Error: Slider orientation is undefined!")}return a},a.Slider.prototype.isInROI=function(a,b){switch(this.type){case"horizontal":if(a>this.getKnobPosition()&&b>this.ROITop&&a<this.getKnobPosition()+this.kWidth&&b<this.ROITop+this.kHeight)return!0;break;case"vertical":if(b>this.getKnobPosition()&&a>this.ROILeft&&b<this.getKnobPosition()+this.kHeight&&a<this.ROILeft+this.kWidth)return!0;break;default:throw new Error("Error: Slider orientation is undefined!")}return!1},a.Slider.prototype.touch=function(a,b){if(this.isInROI(a,b))switch(this.triggered=!0,this.type){case"horizontal":this.drag_offset=a-this.getKnobPosition();break;case"vertical":this.drag_offset=b-this.getKnobPosition();break;default:throw new Error("Error: Slider orientation is undefined!")}return void 0},a.Slider.prototype.release=function(){return this.triggered=!1,this.drag_offset=void 0,void 0},a.Slider.prototype.drag=function(a,b){if(this.triggered===!0){var c,d;switch(this.type){case"horizontal":c=(a-this.zeroLimit-this.drag_offset)/this.width;break;case"vertical":c=(b-this.zeroLimit-this.drag_offset)/this.height;break;default:throw new Error("Error: Slider orientation is undefined!")}return c>1&&(c=1),0>c&&(c=0),d={slot:"slidervalue",value:c}}return void 0},a.Slider.prototype.setValue=function(b,c){0>c||c>1||a.Slider.superclass.setValue.call(this,b,c)},a.Slider.prototype.refresh_CANVAS2D=function(a){if(this.isVisible===!0)switch(a.context.drawImage(this.sliderImage,this.xOrigin,this.yOrigin),this.type){case"horizontal":a.context.drawImage(this.knobImage,this.getKnobPosition(),this.yOrigin);break;case"vertical":a.context.drawImage(this.knobImage,this.xOrigin,this.getKnobPosition());break;default:throw new Error("Error: Slider orientation unknown: ",this.type)}},a.Slider.prototype.calculateDimensions=function(){switch(this.kWidth=this.knobImage.width,this.kHeight=this.knobImage.height,this.setWidth(this.sliderImage.width),this.setHeight(this.sliderImage.height),this.type){case"horizontal":this.totalStride=this.width+this.kWidth,this.additionalEndSpace=Math.round(this.kWidth/2),this.zeroLimit=this.xOrigin-this.additionalEndSpace,this.oneLimit=this.xOrigin+this.width+this.additionalEndSpace;break;case"vertical":this.totalStride=this.height+this.kHeight,this.additionalEndSpace=Math.round(this.kHeight/2),this.zeroLimit=this.yOrigin-this.additionalEndSpace,this.oneLimit=this.yOrigin+this.height+this.additionalEndSpace;break;default:throw new Error("Error: Slider orientation is undefined!")}},a.Slider.prototype.setGraphicWrapper=function(b){a.Slider.superclass.setGraphicWrapper.call(this,b),this.drawClass=b.initObject([{objName:"drawImage",objParms:this.objParms}])},a.Wavebox=function(a){arguments.length&&this.getready(a)},a.extend(a.Wavebox,a.UIElement),a.Wavebox.prototype.getready=function(b){a.Wavebox.superclass.getready.call(this,b),this.values={waveboxposition:0,startsample:0,endsample:null,waveboxsignal:[],xPos:0,yPos:0},this.defaultSlot="waveboxposition",this.setWidth(b.width),this.setHeight(b.height),this.binMethod=b.binMethod||"minmax",this.orientation=b.orientation||0,this.waveColor=b.waveColor||"black"},a.Wavebox.prototype.isInROI=function(a,b){return a>this.ROILeft&&b>this.ROITop&&a<this.ROILeft+this.ROIWidth&&b<this.ROITop+this.ROIHeight?!0:!1},a.Wavebox.prototype.touch=function(a,b){return this.isInROI(a,b)&&(this.triggered=!0),void 0},a.Wavebox.prototype.release=function(a,b){var c={};return this.triggered&&this.isInROI(a,b)?(0===this.orientation?c={slot:"xPos",value:a}:1===this.orientation?c={slot:"yPos",value:b}:console.error("orientation invalid, this will probably break something"),this.triggered=!1,console.log("returning event",c),c):void 0},a.Wavebox.prototype.setValue=function(a,b){if(void 0===this.values[a])throw new Error("Slot "+a+" not present or value undefined");if(this.values[a]!==b){if("startsample"===a||"endsample"===a){if(0>b)throw new Error("Error: Trying to set "+a+" less than 0: "+b);if("undefined"!=typeof this.values.waveboxsignal&&b>this.values.waveboxsignal.length)throw new Error("Error: Trying to set "+a+" bigger than signal length: "+b+" > "+this.values.waveboxsignal.length)}if("startsample"===a&&b>this.values.endsample)throw new Error("Error: Trying to set startsample > endsample: "+b+" > "+this.values.endsample);if("endsample"===a&&b<this.values.startsample)throw new Error("Error: Trying to set endsample < startsample: "+b+" < "+this.values.startsample);this.values[a]=b,"waveboxsignal"===a&&(this.values.endsample=this.values.waveboxsignal.length,this.values.startsample=0),"xPos"==a&&b<=this.width&&(this.values.xPos=b),"yPos"==a&&(b<=this.height?(console.log("Setting yPos to "+b),this.values.yPos=b):console.log("NOT setting yPos to "+b+" because height is "+this.height))}},a.Wavebox.prototype.refresh_CANVAS2D=function(a){if(this.isVisible===!0){var b=a.context;b.fillStyle=this.waveColor;var c,d,e,f,g=this.width,h=this.height;1===this.orientation&&(g=this.height,h=this.width);var i;"minmax"==this.binMethod?i=this.calculateBinMix:"none"==this.binMethod?i=this.calculateBinNone:console.log("Error: no binMethod!");var j;for(e=parseInt((this.values.endsample-this.values.startsample)/g,10),b.beginPath(),0===this.orientation?b.moveTo(this.xOrigin,.5*h+this.yOrigin):1===this.orientation&&b.moveTo(this.xOrigin+.5*h,this.yOrigin),j=0;g>j;j+=1)f=i(j,e,this.values),0===this.orientation?(c=h-(f.max+1)*h/2+this.yOrigin,d=j+this.xOrigin):1===this.orientation&&(c=j+this.yOrigin,d=h-(f.max+1)*h/2+this.xOrigin),b.lineTo(d,c);for(0===this.orientation?b.lineTo(g+this.xOrigin,.5*h+this.yOrigin):1===this.orientation&&b.lineTo(.5*h+this.xOrigin,g+this.yOrigin),b.fill(),b.closePath(),b.beginPath(),0===this.orientation?b.moveTo(this.xOrigin,.5*h+this.yOrigin):1===this.orientation&&b.moveTo(this.xOrigin+.5*h,this.yOrigin),j=0;g>j;j+=1)f=i(j,e,this.values),0===this.orientation&&(c=h-(f.min+1)*h/2+this.yOrigin,d=j+this.xOrigin),1===this.orientation&&(c=j+this.yOrigin,d=h-(f.min+1)*h/2+this.xOrigin),b.lineTo(d,c);0===this.orientation?b.lineTo(g+this.xOrigin,.5*h+this.yOrigin):1===this.orientation&&b.lineTo(.5*h+this.xOrigin,g+this.yOrigin),b.fill(),b.closePath()}},a.Wavebox.prototype.calculateBinMix=function(a,b,c){var d=c.waveboxsignal,e=c.startsample+a*b,f=c.startsample+(a+1)*b;f>c.endsample&&(f=c.endsample);for(var g=d[e],h=d[e],i=1;b>i;i++)d[e+i]<g&&(g=d[e+i]),d[e+i]>h&&(h=d[e+i]);return{max:h,min:g}},a.Wavebox.prototype.calculateBinNone=function(a,b,c){var d=c.startsample+a*b,e=parseInt(b/2,10),f=c.waveboxsignal[d+e];return{max:f,min:-f}},a.Wavebox.prototype.calculateBinAvg=function(a,b){var c=this.values.waveboxsignal,d=this.values.startsample+a*b,e=d+(a+1)*b;e>this.values.endsample&&(e=this.values.endsample);for(var f=c.subarray(d,e),g=0,h=f.length,i=0;h-1>i;i++)g=(f[i+1]+i*g)/(i+1);return g},a.ENGINE={},a.ENGINE.engineFactory=function(a,b){function c(a){this.reset=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},this.canvas=a,this.context=a.getContext("2d"),this.type="CANVAS2D",this.getContext=function(){return this.context},this.getCanvas=function(){return this.canvas}}switch(a){case"CANVAS2D":if(void 0!==b.target)return new c(b.target);throw"Engine: args is undefined";case"ANOTHERTYPE":throw"Engine type not recognized: "+a;default:throw"Engine type not recognized: "+a}};var b=window.CanvasRenderingContext2D&&CanvasRenderingContext2D.prototype;if(b.lineTo&&(b.dashedLine=function(a,b,c,d,e){e||(e=[10,5]),this.save();var f=c-a,g=d-b,h=Math.sqrt(f*f+g*g),i=Math.atan2(g,f);this.translate(a,b),this.moveTo(0,0),this.rotate(i);var j=e.length,k=0,l=!0;for(a=0;h>a;)a+=e[k++%j],a>h&&(a=h),l?this.lineTo(a,0):this.moveTo(a,0),l=!l;this.restore()}),a.OSC={},a.OSC.Message=function(b){this.address=b,this.typetags="",this.args=[];for(var c=1;c<arguments.length;c++){var d=arguments[c];switch(typeof d){case"object":if(!d.typetag)throw new Error("don't know how to encode object "+d);this.typetags+=d.typetag,this.args.push(d);break;case"number":Math.floor(d)==d?(this.typetags+=a.OSC.TInt.prototype.typetag,this.args.push(new a.OSC.TInt(Math.floor(d)))):(this.typetags+=a.OSC.TFloat.prototype.typetag,this.args.push(new a.OSC.TFloat(d)));break;case"string":this.typetags+=a.OSC.TString.prototype.typetag,this.args.push(new a.OSC.TString(d));break;default:throw new Error("don't know how to encode "+d)}}},a.OSC.Message.prototype={toBinary:function(){var b=new a.OSC.TString(this.address),c=[],d=[];if(d=b.encode(),c=c.concat(d),this.typetags){var e=new a.OSC.TString(","+this.typetags);d=e.encode(),c=c.concat(d);for(var f=0;f<this.args.length;f++)d=this.args[f].encode(),c=c.concat(d)}return c}},a.OSC.Bundle=function(b,c){a.OSC.Message.call(this,b),this.timetag=c||0},a.OSC.Bundle.prototype.append=function(b){var c;if(b instanceof Message)c=new a.OSC.TBlob(b.toBinary());else{var d=new a.OSC.Message(this.address);"Object"==typeof b?(b.addr&&(d.address=b.addr),b.args&&d.append.apply(b.args)):d.append(b),c=new a.OSC.TBlob(d.toBinary())}this.message+=c,this.typetags+="b"},a.OSC.Bundle.prototype.toBinary=function(){var b=new a.OSC.TString("#bundle");return b=b.concat(new a.OSC.TTimeTag(this.timetag)),b=b.concat(this.message)},a.OSC.Encoder=function(){},a.OSC.Encoder.prototype={encode:function(){var b;if(arguments[0].toBinary)b=arguments[0].toBinary();else{var c={};a.OSC.Message.apply(c,arguments),b=a.OSC.Message.prototype.toBinary.call(c)}return b}},a.OSC.ShortBuffer=function(a,b,c){this.type="ShortBuffer";for(var d="buffer [",e=0;e<b.length;e++)e&&(d+=", "),d+=b.charCodeAt(e);d+="] too short for "+a+", "+c+" bytes required",this.message=d},a.OSC.TString=function(a){this.value=a},a.OSC.TString.prototype={typetag:"s",decode:function(a){for(var b=0;a[b]&&b<a.length;)b++;if(b==a.length)throw Error("OSC string not null terminated");this.value=String.fromCharCode.apply(null,a.slice(0,b));var c=parseInt(4*Math.ceil((b+1)/4),10);return a.slice(c)},encode:function(){var a=4*Math.ceil((this.value.length+1)/4,10),b=new Array(a);return Struct.PackTo(">"+a+"s",b,0,[this.value])}},a.OSC.TInt=function(a){this.value=a},a.OSC.TInt.prototype={typetag:"i",decode:function(a){if(a.length<4)throw new ShortBuffer("int",a,4);return this.value=Struct.Unpack(">i",a.slice(0,4))[0],a.slice(4)},encode:function(){var a=new Array(4);return Struct.PackTo(">i",a,0,[this.value])}},a.OSC.TTime=function(a){this.value=a},a.OSC.TTime.prototype={typetag:"t",decode:function(a){if(a.length<8)throw new ShortBuffer("time",a,8);return this.value=Struct.Unpack(">LL",a.slice(0,8))[0],a.slice(8)},encode:function(a,b){return Struct.PackTo(">LL",a,b,this.value)}},a.OSC.TFloat=function(a){this.value=a},a.OSC.TFloat.prototype={typetag:"f",decode:function(a){if(a.length<4)throw new ShortBuffer("float",a,4);return this.value=Struct.Unpack(">f",a.slice(0,4))[0],a.slice(4)},encode:function(){var a=new Array(4);return Struct.PackTo(">f",a,0,[this.value])}},a.OSC.TBlob=function(a){this.value=a},a.OSC.TBlob.prototype={typetag:"b",decode:function(a){var b=Struct.Unpack(">i",a.slice(0,4))[0],c=parseInt(4*Math.ceil(b/4),10)+4;return this.value=a.slice(4,b+4),a.slice(c)},encode:function(a,b){var c=4*Math.ceil(this.value.length/4,10);return Struct.PackTo(">i"+c+"s",a,b,[c,this.value])}},a.OSC.TDouble=function(a){this.value=a},a.OSC.TDouble.prototype={typetag:"d",decode:function(a){if(a.length<8)throw new ShortBuffer("double",a,8);return this.value=Struct.Unpack(">d",a.slice(0,8))[0],a.slice(8)},encode:function(a,b){return Struct.PackTo(">d",a,b,[this.value])}},a.OSC.tagToConstructor={i:function(){return new a.OSC.TInt},f:function(){return new a.OSC.TFloat},s:function(){return new a.OSC.TString},b:function(){return new a.OSC.TBlob},d:function(){return new a.OSC.TDouble}},a.OSC.decodeBundle=function(b){var c=[],d={time:null,args:[]},e=new a.OSC.TTime;for(b=e.decode(b),d.time=e.value;b.length>0;){var f=new a.OSC.TInt;b=f.decode(b);var g=a.OSC.decode(b.slice(0,f.value));d.args.push(g),b=b.slice(f.value)}return c.push(d),c},a.OSC.decode=function(b){var c=[],d=new a.OSC.TString;if(b=d.decode(b),c.push(d.value),"#bundle"===d.value)return a.OSC.decodeBundle(b);if(b.length>0){var e=new a.OSC.TString;if(b=e.decode(b),e=e.value,","!=e[0])throw"invalid type tag in incoming OSC message, must start with comma";for(var f=1;f<e.length;f++){var g=a.OSC.tagToConstructor[e[f]];if(!g)throw"Unsupported OSC type tag "+e[f]+" in incoming message";var h=g();b=h.decode(b),c.push(h.value)}}return c},a.OSC.Decoder=function(){},a.OSC.Decoder.prototype.decode=function(b){var c=a.OSC.decode(b);try{if(c)return c}catch(d){console.log("can't decode incoming message: "+d.message)}},a.OSCClient=function(a,b){this.oscHandler=b,this.clientID=a.clientID,this.oscCallback=a.oscCallback,this.isListening=a.isListening||!0},a.OSCClient.prototype.sendOSC=function(a,b){var c=this.oscHandler.OSCEncoder.encode(a),d=b;"undefined"==typeof b&&(d={sendRemote:!0,sendLocal:!0}),d.sendRemote!==!1&&this.oscHandler.proxyOK===!0&&this.oscHandler.socket.emit("osc",{osc:c}),d.sendLocal!==!1&&this.oscHandler.sendLocalMessage.apply(this.oscHandler,[c,this.clientID])},a.OSCHandler=function(b,c){if(this.localClients={},this.OSCDecoder=new a.OSC.Decoder,this.OSCEncoder=new a.OSC.Encoder,this.udpServers=c||null,this.proxyServer=b||null,this.proxyOK=!1,this.proxyConnected=!1,null!==this.proxyServer){try{this.socket=io.connect("http://"+this.proxyServer.host+":"+this.proxyServer.port)}catch(d){return console.error("io.connect failed. No proxy server?"),void 0}this.socket.on("admin",function(a){console.log("Received an admin message: ",a),this.proxyOK=!0,null!==this.udpServers&&this.socket.emit("admin",{type:"udphosts",content:this.udpServers})}.bind(this)),this.socket.on("osc",function(a){var b=Array.prototype.slice.call(a.osc,0);console.log("received osc from the server: "+b),this.sendLocalMessage(b)}.bind(this)),this.socket.on("disconnect",function(){console.log("socket disconnected"),this.proxyConnected=!1,this.proxyOK=!1}.bind(this)),this.socket.on("connect",function(){console.log("socket connected"),this.proxyConnected=!0}.bind(this))}},a.OSCHandler.prototype.registerClient=function(b){return this.localClients[b.clientID]=new a.OSCClient(b,this),this.localClients[b.clientID]},a.OSCHandler.prototype.unregisterClient=function(a){delete this.localClients[a]},a.OSCHandler.prototype.sendLocalMessage=function(a,b){var c=this.OSCDecoder.decode(a);console.log("decoded OSC = "+c);for(var d in this.localClients)if(this.localClients.hasOwnProperty(d)){var e=this.localClients[d];e.clientID!==b&&e.isListening&&"function"==typeof e.oscCallback&&e.oscCallback(c)}},a.loadImageArray=function(a){this.onCompletion=function(){if("function"==typeof this.onComplete){var a=this.pollStatus(),b={imagesArray:this.imagesArray,status:a};this.onComplete(b)}},this.onLoad=function(a){return function(){a.objectsLoaded+=1,a.check(a.onSingle,this)}},this.onError=function(a){return function(){a.objectsError+=1,a.check(a.onErr,this)}},this.check=function(a,b){if("function"==typeof a){var c=this.pollStatus();a({obj:b,status:c})}this.objectsLoaded+this.objectsError===this.objectsTotal&&this.onCompletion()},this.pollStatus=function(){return{id:this.ID,loaded:this.objectsLoaded,error:this.objectsError,total:this.objectsTotal}},this.ID=a.ID,this.onComplete=a.onComplete,this.onSingle=a.onSingle,this.onErr=a.onError,this.objectsLoaded=0,this.objectsError=0,this.objectsTotal=a.imageNames.length,this.imagesArray=[];for(var b=0;b<this.objectsTotal;b+=1)this.imagesArray[b]=new Image,this.imagesArray[b].onload=this.onLoad(this),this.imagesArray[b].onerror=this.onError(this),this.imagesArray[b].src=a.imageNames[b]},a.loadMultipleImages=function(a){this.loadingManager=function(){var a=this;return function(b){var c=b;if(void 0===a.loaders[c.status.id])throw new Error("in loaders, "+c.status.id+" is undefined");a.loaders[c.status.id].done=!0,a.loaders[c.status.id].images=a.loaders[c.status.id].imageArray.imagesArray,"function"==typeof a.onSingleArray&&a.onSingleArray(b);for(var d in a.loaders)if(a.loaders.hasOwnProperty(d)&&a.loaders[d].done!==!0)return;a.onComplete(a.loaders)}},this.errorManager=function(){var a=this;return function(b){"function"==typeof a.onError&&a.onError(b)}},this.singleManager=function(){var a=this;return function(b){"function"==typeof a.onSingle&&a.onSingle(b)}},this.multipleImages=a.multipleImages,this.onComplete=a.onComplete,this.onError=a.onError,this.onSingle=a.onSingle,this.onSingleArray=a.onSingleArray,this.loaders={};for(var b=0;b<this.multipleImages.length;b+=1){var c={};c.imageArray=new loadImageArray({ID:this.multipleImages[b].ID,imageNames:this.multipleImages[b].imageNames,onComplete:this.loadingManager(),onError:this.errorManager(),onSingle:this.singleManager()}),c.done=!1,this.loaders[this.multipleImages[b].ID]=c}},a.GenericUtils={},a.GenericUtils.clone=function(b){var c;if(null===b||"object"!=typeof b)return b;if(b instanceof Date)return c=new Date,c.setTime(b.getTime()),c;if(b instanceof Array){c=[];for(var d=0,e=b.length;e>d;++d)c[d]=a.GenericUtils.clone(b[d]);return c}if(b instanceof Object){c={};for(var f in b)b.hasOwnProperty(f)&&(c[f]=a.GenericUtils.clone(b[f]));return c}throw new Error("Unable to copy obj! Its type isn't supported.")},a.MathUtils={},a.MathUtils.linearRange=function(a,b,c,d,e){var f=(e-a)*(d-c)/(b-a)+c;return f},a.MathUtils.distance=function(a,b,c,d){return Math.sqrt(Math.pow(a-c,2)+Math.pow(b-d,2))},a.MathUtils.fact_table=[1,1,2,6,24,120,720,5040,40320,362880,3628800,39916800,479001600,6227020800,87178291200,1307674368e3,20922789888e3,355687428096e3,6402373705728e3,0x1b02b9306890000,243290200817664e4,5109094217170944e4,0x3ceea4c2b3e0d80000,2.585201673888498e22,6.204484017332394e23,1.5511210043330986e25,4.0329146112660565e26,1.0888869450418352e28,3.0488834461171387e29,8.841761993739702e30,2.6525285981219107e32,8.222838654177922e33,2.631308369336935e35,8.683317618811886e36,2.9523279903960416e38,1.0333147966386145e40,3.7199332678990125e41,1.3763753091226346e43,5.230226174666011e44,2.0397882081197444e46,8.159152832478977e47,3.345252661316381e49,1.40500611775288e51,6.041526306337383e52,2.658271574788449e54,1.1962222086548019e56,5.502622159812089e57,2.5862324151116818e59,1.2413915592536073e61,6.082818640342675e62,3.0414093201713376e64,1.5511187532873822e66,8.065817517094388e67,4.2748832840600255e69,2.308436973392414e71,1.2696403353658276e73,7.109985878048635e74,4.0526919504877214e76,2.3505613312828785e78,1.3868311854568984e80,8.32098711274139e81,5.075802138772248e83,3.146997326038794e85,1.98260831540444e87,1.2688693218588417e89,8.247650592082472e90,5.443449390774431e92,3.647111091818868e94,2.4800355424368305e96,1.711224524281413e98,1.1978571669969892e100,8.504785885678623e101,6.1234458376886085e103,4.4701154615126844e105,3.307885441519386e107,2.48091408113954e109,1.8854947016660504e111,1.4518309202828587e113,1.1324281178206297e115,8.946182130782976e116,7.156945704626381e118,5.797126020747368e120,4.753643337012842e122,3.945523969720659e124,3.314240134565353e126,2.81710411438055e128,2.4227095383672734e130,2.107757298379528e132,1.8548264225739844e134,1.650795516090846e136,1.4857159644817615e138,1.352001527678403e140,1.2438414054641308e142,1.1567725070816416e144,1.087366156656743e146,1.032997848823906e148,9.916779348709496e149,9.619275968248212e151,9.426890448883248e153,9.332621544394415e155,9.332621544394415e157],a.MathUtils.fact_lookup=function(b){if(100>=(b>0))return a.MathUtils.fact_table[b];
for(var c=1,d=2;b>=d;d++)c*=d;return c},a.CanvasUtils={},a.CanvasUtils.drawRotate=function(a,b){a.save(),a.translate(b.x+b.image.width/2,b.y+b.image.height/2),a.rotate(b.rot),a.translate(-(b.image.width/2)-b.x,-(b.image.height/2)-b.y),a.drawImage(b.image,b.x,b.y),a.restore()},"function"==typeof define&&define.amd)console.log("AMD detected, setting define"),define(["github:EightMedia/hammer.js@1.0/dist/hammer"],function(b){return console.log("KievII: returning K2 object inside the define (AMD detected)"),a.Hammer=b,a});else{if(console.log("KievII: setting window.K2 (no AMD)"),"undefined"==typeof window.Hammer)throw"Hammer.js needed!";a.Hammer=window.Hammer,window.kievII=window.K2=a}}();