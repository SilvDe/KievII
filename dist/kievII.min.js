(function(){function o(e,t){return t=t||5e3,function(){function i(t){return n[t]||(r-->0?n[t]=e(t):e(t))}var n={},r=t;return i}()}var e={};e.extend=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.superclass=t.prototype,t.prototype.constructor==Object.prototype.constructor&&(t.prototype.constructor=t)},e.clone=function(e){var t;if(null===e||"object"!=typeof e)return e;if(e instanceof Date)return t=new Date,t.setTime(e.getTime()),t;if(e instanceof Array){t=[];for(var n=0,r=e.length;n<r;++n)t[n]=clone(e[n]);return t}if(e instanceof Object){t={};for(var i in e)e.hasOwnProperty(i)&&(t[i]=clone(e[i]));return t}throw new Error("Unable to copy obj! Its type isn't supported.")},e.mergeObject=function(e,t){var n={};if(!t)return e;for(var r in e)r in t?n[r]=t[r]:n[r]=e[r];return n},typeof console=="undefined"&&(console={"log":function(e){var t=!1;t&&alert(e)}}),e.UIElement=function(e){arguments.length&&this.getready(e)},e.UIElement.prototype.getready=function(e){this.ID=e.ID,this.isListening=e.isListening,typeof this.isListening=="undefined"&&(this.isListening=!0);if(typeof this.isListening!="boolean")throw"Property isListening for element "+this.ID+" is not boolean "+this.isListening;this.isVisible=e.isVisible,typeof this.isVisible=="undefined"&&(this.isVisible=!0);if(typeof this.isVisible!="boolean")throw"Property isVisible for element "+this.ID+" is not boolean "+this.isVisible;this.xOrigin=e.left,this.yOrigin=e.top,typeof e.ROILeft!="undefined"?this.ROILeft=e.ROILeft:this.ROILeft=this.xOrigin,typeof e.ROITop!="undefined"?this.ROITop=e.ROITop:this.ROITop=this.yOrigin,this.ROIWidth=e.ROIWidth,this.ROIHeight=e.ROIHeight,this.values={},this.transparency=e.transparency||1,this.objParms=e.objParms,typeof e!="undefined"&&(this.onValueSet=e.onValueSet)},e.UIElement.prototype.isInROI=function(e,t){return!1},e.UIElement.prototype.getValues=function(){var e=[],t;for(t in this.values)this.values.hasOwnProperty(t)&&e.push(t);return e},e.UIElement.prototype.getXCoord=function(){return this.xOrigin},e.UIElement.prototype.getYCoord=function(){return this.yOrigin},e.UIElement.prototype.getWidth=function(){return this.width},e.UIElement.prototype.getHeight=function(){return this.height},e.UIElement.prototype.setHeight=function(e){this.height=e,typeof this.ROIHeight=="undefined"&&(this.ROIHeight=e)},e.UIElement.prototype.setWidth=function(e){this.width=e,typeof this.ROIWidth=="undefined"&&(this.ROIWidth=e)},e.UIElement.prototype.getValue=function(e){if(typeof this.values[e]=="undefined")throw new Error("Slot "+e+" not present or value undefined");return this.values[e]},e.UIElement.prototype.setValue=function(e,t){if(typeof this.values[e]=="undefined")throw new Error("Slot "+e+" not present or value undefined");if(t===this.values[e])return;this.values[e]=t},e.UIElement.prototype.setListening=function(e){if(typeof e!="boolean")throw"Property isListening for element "+this.ID+" is not boolean "+e;this.isListening=e},e.UIElement.prototype.getListening=function(){return this.isListening},e.UIElement.prototype.refresh=function(e){var t="call_"+e.type;if(typeof this[t]!="function")throw"Element "+this.ID+" "+t+" is not a function. Its type is "+typeof this[t];this[t](e)},e.UIElement.prototype.call_CANVAS2D=function(e){var t="refresh_"+e.type;e.context.save(),e.context.globalAlpha=this.transparency;if(typeof this[t]!="function")throw"Element "+this.ID+" "+t+" is not a function. Its type is "+typeof this[t];this[t](e),e.context.restore()},e.UIElement.prototype.getID=function(){return this.ID},e.UIElement.prototype.setDrawClass=function(e){this.drawClass=e},e.UIElement.prototype.setVisible=function(e){if(typeof e!="boolean")throw"Property isVisible for element "+this.ID+" is not boolean "+e;this.isVisible=e},e.UIElement.prototype.getVisible=function(){return this.isVisible},e.UIElement.prototype.setGraphicWrapper=function(e){this.wrapper=e},e.UI=function(t,n){this.getEventPosition=function(e,t){var n=parseInt(document.defaultView.getComputedStyle(t,undefined).paddingLeft,10)||0,r=parseInt(document.defaultView.getComputedStyle(t,undefined).paddingTop,10)||0,i=parseInt(document.defaultView.getComputedStyle(t,undefined).borderLeftWidth,10)||0,s=parseInt(document.defaultView.getComputedStyle(t,undefined).borderTopWidth,10)||0,o=document.body.parentNode,u=o.offsetTop,a=o.offsetLeft,f=t,l=0,c=0,h,p;if(f.offsetParent!==undefined)do l+=f.offsetLeft,c+=f.offsetTop;while(f=f.offsetParent);l+=n+i+a,c+=r+s+u,h=e.pageX-l,p=e.pageY-c;var d=parseInt(document.defaultView.getComputedStyle(t,null).getPropertyValue("width"),10)||0,v=parseInt(document.defaultView.getComputedStyle(t,null).getPropertyValue("height"),10)||0,m=t.getAttribute("width"),g=t.getAttribute("height"),y=m/d,b=g/v;return h*=y,p*=b,{"x":h,"y":p}},this.getPosition=function(e){var t=0,n=0;if(e.offsetParent)do t+=e.offsetLeft,n+=e.offsetTop,e=e.offsetParent;while(e);return{"x":t,"y":n}},this.onMouseEvent=function(){var e=this;return function(t){var n=t,r=t.type,i=e.getEventPosition(n,e.domElement);r==="mousedown"?e.mouseUp=!1:r==="mouseup"&&(e.mouseUp=!0),r==="mousemove"&&e.mouseUp===!1&&e.elementsNotifyEvent(i.x,i.y,r),e.elementsNotifyEvent(i.x,i.y,r)}},this.onHammerEvent=function(){var e=this;return function(t){var n=t.gesture.srcEvent,r=t.type,i=e.getEventPosition(n,e.domElement,t);console.log("About to notify an Hammer event of type",r),e.elementsNotifyEvent(i.x,i.y,r)}},this.elementsNotifyEvent=function(e,t,n){for(var r=this.zMax;r>=this.zMin;r-=1)if(typeof this.zArray[r]!="undefined")for(var i=this.zArray[r].length-1;i>=0;i-=1)if(this.zArray[r][i].getListening()&&typeof this.zArray[r][i][n]=="function"){var s=this.zArray[r][i][n](e,t);if(typeof s!="undefined"){if(s instanceof Array)for(var o=0;o<s.length;o+=1)this.setValue({"elementID":this.zArray[r][i].ID,"slot":s[o].slot,"value":s[o].value});else this.setValue({"elementID":this.zArray[r][i].ID,"slot":s.slot,"value":s.value});if(this.breakOnFirstEvent===!0)return}}};var r=t.eventTarget||t.target,i=t.renderTarget||t.target;this.domElement=r;var s=function(){function t(t){var n=document.createElement(e[t]||"div");t="on"+t;var r=t in n;return r||(n.setAttribute(t,"return;"),r=typeof n[t]=="function"),n=null,r}var e={"select":"input","change":"input","submit":"form","reset":"form","error":"img","load":"img","abort":"img"};return t}();if(typeof e.Hammer=="undefined")throw"Hammer.js needed!";this.hammer=new e.Hammer(this.domElement,{"drag_min_distance":2});var o=this.onHammerEvent();this.hammer.on("dragstart drag dragend swipe tap doubletap hold transformstart transform transformend touch release",o),s("touchstart")?(this.domElement.addEventListener("touchstart",this.onMouseEvent(),!0),console.log("touchstart supported")):(this.domElement.addEventListener("mousedown",this.onMouseEvent(),!0),console.log("no touchstart, supporting mousedown")),s("touchend")?(this.domElement.addEventListener("touchend",this.onMouseEvent(),!0),console.log("touchend supported")):(this.domElement.addEventListener("mouseup",this.onMouseEvent(),!0),console.log("no touchend, supporting mouseup")),this.domElement.addEventListener("mousemove",this.onMouseEvent(),!0),this.domElement.addEventListener("mouseover",this.onMouseEvent(),!0),this.domElement.addEventListener("mouseout",this.onMouseEvent(),!0),this.mouseUp=!0;var u;this.elements={},this.connections={},this.zArray=[],this.engine=e.ENGINE.engineFactory(t.type,{"target":i}),typeof n!="undefined"&&(this.breakOnFirstEvent=n.breakOnFirstEvent||!1),this.addElement=function(e,t){var n,r;if(typeof this.elements[e.ID]!="undefined")throw new Error("Conflicting / Duplicated ID in UI: "+e.ID+" (IDs are identifiers and should be unique)");var i=0;typeof t!="undefined"&&typeof t.zIndex!="undefined"&&(i=t.zIndex);if(i<0||typeof i!="number")throw new Error("zIndex "+i+" invalid");var s={"element":e,"zIndex":i};this.elements[e.ID]=s,r=e.getValues(),typeof this.zArray[i]=="undefined"&&(this.zArray[i]=[]),this.zArray[i].push(this.elements[e.ID].element);if(typeof this.zMin=="undefined"||this.zMin>i)this.zMin=i;if(typeof this.zMax=="undefined"||this.zMax<i)this.zMax=i},this.removeElement=function(e){if(typeof this.elements[e]!="undefined"){var t=this.elements[e].zIndex,n=this.zArray[t];for(var r=0;r<n.length;r+=1)if(n[r].ID===e){n.splice(r,1);break}delete this.elements[e]}},this.isElement=function(e){return typeof this.elements[e]!="undefined"?!0:!1},this.setZIndex=function(e,t){if(typeof this.elements[e]=="undefined")throw"Could not find element ID: "+e;var n=this.elements[e].zIndex;if(n!==t){typeof this.zArray[t]=="undefined"&&(this.zArray[t]=[]);if(typeof this.zMin=="undefined"||this.zMin>t)this.zMin=t;if(typeof this.zMax=="undefined"||this.zMax<t)this.zMax=t;var r=this.zArray[n],i=this.zArray[t];for(var s=0;s<r.length;s+=1)if(r[s].ID===e){r.splice(s,1);break}i.push(this.elements[e].element),this.elements[e].zIndex=t}},this.getZIndex=function(e){if(typeof this.elements[e]!="undefined")return this.elements[e].zIndex;throw"Could not find element ID: "+e},this.setProp=function(e,t,n){if(typeof this.elements[e]=="undefined")throw"Could not find ID: "+e+" property: "+t;this.elements[e].element[t]=n},this.getProp=function(e,t){if(typeof this.elements[e]!="undefined")return this.elements[e].element[t];throw"Could not find ID: "+e+" property: "+t},this.getElement=function(e){return this.elements[e].element},this.connectSlots=function(e,t,n,r,i){if(typeof this.elements[e]=="undefined"||typeof this.elements[n]=="undefined")throw new Error("Element "+e+" or "+n+" not present.");if(typeof this.elements[e].element.values[t]=="undefined"||typeof this.elements[n].element.values[r]=="undefined")throw new Error("Slot "+t+" or "+r+" not present.");var s={"recvElement":n,"recvSlot":r};typeof i!="undefined"&&(typeof i.callback=="function"&&(s.callback=i.callback),s.cascade=!0,typeof i.cascade!="undefined"&&(s.cascade=i.cascade)),typeof this.connections[e]=="undefined"&&(this.connections[e]={}),typeof this.connections[e][t]=="undefined"&&(this.connections[e][t]=[]),this.connections[e][t].push(s)},this.resetSlots=function(){this.connections={}},this.unconnectSlots=function(e,t,n,r){},this.resetSenderSlot=function(e){},this.setValue=function(e){var t=[],n,r,i,s,o=1e3,u,a,f,l,c,h;if(typeof e.elementID=="undefined")throw"ID is undefined";u=e.elementID;if(typeof e.value=="undefined")throw"value is undefined";a=e.value,typeof e.fireCallback=="undefined"?l=!0:l=e.fireCallback,c=e.history;if(typeof this.elements[u]=="undefined")throw new Error("Element "+u+" not present.");if(typeof e.slot=="undefined"){f=this.elements[u].element.defaultSlot;if(typeof f===undefined)throw"Default slot is undefined!"}else f=e.slot;if(typeof c!="undefined"){t=c;for(var p=0;p<t.length;p+=1){if(t.length>o)throw new Error("Recursion exceeded");if(t[p].element===u&&t[p].slot===f)return}}this.elements[u].element.setValue(f,a),typeof this.elements[u].element.onValueSet=="function"&&l!==!1&&this.elements[u].element.onValueSet(f,this.elements[u].element.values[f],u),t.push({"element":u,"slot":f});if(typeof this.connections[u]!="undefined"&&typeof this.connections[u][f]!="undefined")for(s in this.connections[u][f])if(this.connections[u][f].hasOwnProperty(s)){n=this.connections[u][f][s],r=n.recvElement,i=n.recvSlot;if(typeof n.callback=="function"){var d={"sender":u,"sendSlot":f,"recv":r,"recvSlot":i,"ui":this};h=n.callback(a,d)}var v;n.cascade===!1?v=!1:v=!0,this.setValue({"elementID":r,"slot":i,"value":h,"history":t,"fireCallback":v})}},this.hideElement=function(e){var t;if(typeof this.elements[e]=="undefined")throw new Error("Element "+e+" not present.");t=this.elements[e].element.getVisible(),t===!0&&(this.elements[e].element.setVisible(!1),this.elements[e].element.setListening(!1))},this.unhideElement=function(e){var t;if(typeof this.elements[e]=="undefined")throw new Error("Element "+e+" not present.");t=this.elements[e].element.getVisible(),t===!1&&(this.elements[e].element.setVisible(!0),this.elements[e].element.setListening(!0))},this.setHidden=function(e,t){this.setVisible(e,!t)},this.setVisible=function(e,t){var n;if(typeof this.elements[e]=="undefined")throw new Error("Element "+e+" not present.");n=this.elements[e].element.getVisible(),n!==t&&(this.elements[e].element.setVisible(t),this.elements[e].element.setListening(t))},this.setListening=function(e,t){var n;if(typeof this.elements[e]=="undefined")throw new Error("Element "+e+" not present.");n=this.elements[e].element.getListening(),n!==t&&this.elements[e].element.setListening(t)},this.refreshZ=function(e){for(var t=e,n=this.zArray.length;t<n;t+=1)if(typeof this.zArray[t]=="object")for(var r=0,i=this.zArray[t].length;r<i;r+=1)this.zArray[t][r].getVisible()===!0&&this.zArray[t][r].refresh(this.engine)},this.refresh=function(e){e!==!1&&this.reset(),typeof this.zMin!="undefined"&&this.refreshZ(this.zMin)},this.reset=function(){this.engine.reset()}},e.Area=function(e){arguments.length&&this.getready(e)},e.extend(e.Area,e.UIElement),e.Area.prototype.getready=function(t){var n,r;e.Area.superclass.getready.call(this,t),this.values={"width":0,"height":0,"selected":[],"xOffset":0,"yOffset":0,"doubletap":[],"held":[]},this.defaultSlot="height",this.color=t.color||"black",this.borderColor=t.borderColor||"green",this.proximity=Math.floor(t.proximity)||10,this.thickness=Math.floor(t.thickness)||this.proximity,t.thickness===0&&(this.thickness=0),this.borders=t.borders||{"top":!0,"bottom":!0,"right":!0,"left":!0},this.dragBorders=t.dragBorders||{"top":!0,"bottom":!0,"right":!0,"left":!0},this.move=t.move||"all",this.xMonotone=t.xMonotone||!1,this.yMonotone=t.yMonotone||!1;var i=t.height||0,s=t.width||0;this.values.width=s,this.values.height=i;var o=t.left||0,u=t.top||0;this.values.xOffset=o,this.values.yOffset=u},e.Area.prototype.isInArea=function(e,t){var n=!1,r=!1;return this.values.width>0?e>this.values.xOffset&&e<this.values.xOffset+this.values.width&&(n=!0):e<this.values.xOffset&&e>this.values.xOffset+this.values.width&&(n=!0),this.values.height>0?t>this.values.yOffset&&t<this.values.height+this.values.yOffset&&(r=!0):t<this.values.yOffset&&t>this.values.height+this.values.yOffset&&(r=!0),n&&r?!0:!1},e.Area.prototype.tap=e.Area.prototype.dragstart=function(e,t){var n=this.values.xOffset-this.proximity,r=this.values.xOffset+this.proximity,i=this.values.xOffset+this.values.width-this.proximity,s=this.values.xOffset+this.values.width+this.proximity,o=this.values.height+this.values.yOffset+this.proximity,u=this.values.height+this.values.yOffset-this.proximity,a=this.values.yOffset+this.proximity,f=this.values.yOffset-this.proximity;e>n&&e<r&&this.dragBorders.left===!0&&(this.leftSide=!0,console.log("Left side click detected")),e>i&&e<s&&this.dragBorders.right===!0&&(this.rightSide=!0,console.log("Right side click detected")),t>u&&t<o&&this.dragBorders.bottom===!0&&(this.bottomSide=!0,console.log("Bottom side click detected")),t>f&&t<a&&this.dragBorders.top===!0&&(this.topSide=!0,console.log("Top side click detected")),this.isInArea(e,t)?(console.log("clicked inside!"),this.inside=!0,this.startPoint=[e,t]):this.inside=!1},e.Area.prototype.drag=function(e,t){var n=[],r,i;if(this.leftSide&&this.borders.left){r=this.values.width-(e-this.values.xOffset);var s=e;this.xMonotone&&r<0&&(r=0,s=this.values.xOffset),n.push({"slot":"width","value":r}),n.push({"slot":"xOffset","value":s})}this.rightSide&&this.borders.right&&!this.leftSide&&(r=e-this.values.xOffset,this.xMonotone&&r<0&&(r=0),n.push({"slot":"width","value":r})),this.bottomSide&&this.borders.bottom&&(i=this.values.height+(t-(this.values.yOffset+this.values.height)),this.yMonotone&&i<0&&(i=0),n.push({"slot":"height","value":i}));if(this.topSide&&this.borders.top&&!this.bottomSide){i=this.values.height+(this.values.yOffset-t);var o=t;this.yMonotone&&i<0&&(i=0,o=this.values.yOffset),n.push({"slot":"yOffset","value":o}),n.push({"slot":"height","value":i})}if(n.length>0)return n;if(this.inside&&this.move!=="none"){var u=e-this.startPoint[0],a=t-this.startPoint[1];this.startPoint=[e,t];if(this.move==="all")return[{"slot":"xOffset","value":this.values.xOffset+u},{"slot":"yOffset","value":this.values.yOffset+a}];if(this.move==="x")return{"slot":"xOffset","value":this.values.xOffset+u};if(this.move==="y")return{"slot":"yOffset","value":this.values.yOffset+a}}},e.Area.prototype.release=e.Area.prototype.dragend=e.Area.prototype.mouseup=function(e,t){var n;return this.leftSide=this.rightSide=this.bottomSide=this.topSide=!1,this.inside&&this.isInArea(e,t)&&(n={"slot":"selected","value":[e,t]}),this.inside=!1,n},e.Area.prototype.hold=function(e,t){if(this.isInArea(e,t)){var n={"slot":"held","value":[e,t]};return n}},e.Area.prototype.doubletap=function(e,t){if(this.isInArea(e,t))return{"slot":"doubletap","value":[e,t]}},e.Area.prototype.setValue=function(t,n){e.Area.superclass.setValue.call(this,t,n)},e.Area.prototype.refresh_CANVAS2D=function(e){if(this.isVisible===!0){e.context.fillStyle=this.color,e.context.strokeStyle=this.borderColor,e.context.lineWidth=this.thickness;var t=Math.floor(this.thickness/2);e.context.fillRect(this.xOrigin+this.values.xOffset+t,this.values.yOffset+t,this.values.width-t*2,this.values.height-t*2),this.thickness>0&&e.context.strokeRect(this.xOrigin+this.values.xOffset,this.values.yOffset,this.values.width,this.values.height)}},e.Area.prototype.getXCoord=function(){return this.values.xOrigin},e.Area.prototype.getYCoord=function(){return this.values.yOrigin},e.Area.prototype.getWidth=function(){return this.values.width},e.Area.prototype.getHeight=function(){return this.values.height},e.Area.prototype.setHeight=function(e){this.values.height=e,typeof this.ROIHeight=="undefined"&&(this.ROIHeight=e)},e.Area.prototype.setWidth=function(e){this.values.width=e,typeof this.ROIWidth=="undefined"&&(this.ROIWidth=e)},e.Curve=function(e){arguments.length&&this.getready(e)},e.extend(e.Curve,e.UIElement),e.Curve.prototype.getready=function(t){e.Curve.superclass.getready.call(this,t),this.values={"points":[],"selected":[],"held":[],"doubletap_c":[],"doubletap_h":[]},this.defaultSlot="points",this.setWidth(t.width),this.setHeight(t.height),this.curveType=t.curveType||"bezier",this.thickness=t.thickness||2,this.curveColor=t.curveColor||"black",this.helperColor=t.helperColor||"#CCCCCC",this.handleColor=t.handleColor||"red",this.curveLabels=typeof t.curveLabels=="boolean"?t.curveLabels:!1,this.terminalPointStyle=t.terminalPointStyle||"rect",this.paintTerminalPoints=t.paintTerminalPoints||"all",this.midPointStyle=t.midPointStyle||"circle",this.terminalPointSize=t.terminalPointSize||16,this.midPointSize=t.midPointSize||8,this.terminalPointColor=t.terminalPointColor||this.handleColor,this.midPointColor=t.midPointColor||this.handleColor,this.terminalPointFill=t.terminalPointFill||null,this.midPointFill=t.midPointFill||null,this.xMonotone=t.xMonotone||!1,this.handleSize=t.handleSize||this.terminalPointSize>this.midPointSize?this.terminalPointSize:this.midPointSize,this.handleClicked=null,this.supportPoints=[],this.selectStart=!1,this.whereHappened=[];switch(t.curveType){case"bezier":if(t.points.length%2!==0||t.points.length<4)throw"Incorrect number of points "+t.points.length;break;case"halfcosine":case"smooth":case"linear":if(t.points.length!==4)throw"Incorrect number of points "+t.points.length;break;default:throw"Unknown curve type "+t.curveType}var n=[];for(var r=0;r<t.points.length;r+=2)n.push([t.points[r],t.points[r+1]]);this.values.points=n},e.Curve.prototype.isInCurve=function(e,t){for(i=0;i<this.supportPoints.length;i+=1)if(e>this.supportPoints[i][0]-this.thickness&&e<this.supportPoints[i][0]+this.thickness&&t>this.supportPoints[i][1]-this.thickness&&t<this.supportPoints[i][1]+this.thickness)return!0;return!1},e.Curve.prototype.isInHandle=function(e,t){var n=this.values.points;for(var r=0;r<n.length;r+=1)if(e>n[r][0]-this.handleSize&&e<n[r][0]+this.handleSize&&t>n[r][1]-this.handleSize&&t<n[r][1]+this.handleSize)return r;return null},e.Curve.prototype.isInROI=function(e,t){return e>this.ROILeft&&t>this.ROITop&&e<this.ROILeft+this.ROIWidth&&t<this.ROITop+this.ROIHeight?!0:!1},e.Curve.prototype.tap=e.Curve.prototype.dragstart=e.Curve.prototype.mousedown=function(e,t){var n=this.values.points;if(this.isInROI(e,t)){var r;if((r=this.isInHandle(e,t))!==null){this.handleClicked=r;if(r===0||r===n.length-1)return}if(this.isInCurve(e,t)){this.selectStart=!0;return}}},e.Curve.prototype.xMonotoneFunc=function(e){e[0][0]>e[e.length-1][0]&&(e[0][0]>this.values.points[0][0]?e[0][0]=e[e.length-1][0]:e[e.length-1][0]=e[0][0])},e.Curve.prototype.drag=function(t,n){var r={},i;return this.handleClicked!==null?(i=e.GenericUtils.clone(this.values.points),this.isInROI(t,n)?(this.triggered=!1,i[this.handleClicked][0]=t,i[this.handleClicked][1]=n):(i[this.handleClicked][0]=t,i[this.handleClicked][1]=n,t>this.ROILeft+this.ROIWidth&&(i[this.handleClicked][0]=this.ROILeft+this.ROIWidth),t<this.ROILeft&&(i[this.handleClicked][0]=this.ROILeft),n>this.ROITop+this.ROIHeight&&(i[this.handleClicked][1]=this.ROITop+this.ROIHeight),n<this.ROITop&&(i[this.handleClicked][1]=this.ROITop)),this.whereHappened=[i[this.handleClicked][0],i[this.handleClicked][1]],r={"slot":"points","value":i},r):undefined},e.Curve.prototype.dragend=e.Curve.prototype.swipe=function(e,t){if(e<0&&t<0)return;var n=this.drag(e,t);return this.handleClicked=null,n},e.Curve.prototype.release=e.Curve.prototype.mouseup=function(e,t){this.handleClicked=null;if(this.selectStart===!0&&this.isInCurve(e,t)){this.selectStart=!1;var n={"slot":"selected","value":[e,t]};return n}},e.Curve.prototype.hold=function(e,t){if(this.isInROI(e,t)&&this.isInCurve(e,t)){var n={"slot":"held","value":[e,t]};return n}},e.Curve.prototype.doubletap=function(e,t){if(this.isInROI(e,t)){var n;if((n=this.isInHandle(e,t))!==null)return{"slot":"doubletap_h","value":[[e,t],n]};if(this.isInCurve(e,t))return{"slot":"doubletap_c","value":[e,t]}}},e.Curve.prototype.setValue=function(t,n){var r=!0;if(t==="points"){var i=this.values[t];for(var s=0;s<n.length;s+=1){for(var o=0;o<n.length;o+=1)if(n[s][o]!==i[s][o]){r=!1;break}if(r===!1)break}}else r=!1;this.xMonotone&&this.xMonotoneFunc(n),r||e.Curve.superclass.setValue.call(this,t,n)},e.Curve.prototype.refresh_CANVAS2D=function(e){if(this.isVisible===!0){var t=e.context,n=this.values.points,r={"thickness":this.thickness,"curveColor":this.curveColor,"helperColor":this.helperColor,"handleColor":this.handleColor,"handleSize":this.handleSize,"curveLabels":this.curveLabels};this.genericCurve(this.values.points,this.curveType),this.paintCurve(t),this.paintPoints(t,this.values.points,r)}},e.Curve.prototype.getCurvePoints=function(e){var t=1/e,n=[];for(var r=0;r<=1;r+=t){var i=this[this.curveType].P(r,this.values.points);n.push(i)}return n},e.Curve.prototype.getCurveYPoints=function(e,t){typeof t=="undefined"&&(t=1);var n=1/e,r=[];for(var i=0;i<=1;i+=n){var s=this[this.curveType].P(i,this.values.points)[1]*t;r.push(s)}return r},e.Curve.prototype.getPoint=function(e){return this.supportPoints[e]},e.Curve.prototype.getnumPoints=function(){return this.supportPoints.length},e.Curve.prototype.halfcosine={"P":function(e,t){var n=(1-Math.cos(e*Math.PI))/2,r=[0,0];return r[0]=t[0][0]+(t[1][0]-t[0][0])*e,r[1]=t[0][1]*(1-n)+t[1][1]*n,r}},e.Curve.prototype.smooth={"P":function(e,t){var n=e*e*(3-2*e),r=[0,0];return r[0]=t[0][0]+(t[1][0]-t[0][0])*e,r[1]=t[0][1]+n*(t[1][1]-t[0][1]),r}},e.Curve.prototype.linear={"P":function(e,t){var n=[0,0];return n[0]=t[0][0]+(t[1][0]-t[0][0])*e,n[1]=t[0][1]*(1-e)+t[1][1]*e,n}},e.Curve.prototype.cubic={"P":function(e,t){var n=[0,0];n[0]=t[0][0]+(t[3][0]-t[0][0])*e;var r=e,i=e*e,s=t[3][1]-t[2][1]-t[0][1]+t[1][1],o=t[0][1]-t[1][1]-s,u=t[2][1]-t[0][1],a=t[1][1];return n[1]=s*r*i+o*i+u*r+a,n}},e.Curve.prototype.catmull={"P":function(e,t){var n=[0,0];n[0]=t[0][0]+(t[3][0]-t[0][0])*e;var r=e,i=e*e,s=t[0][1],o=t[1][1],u=t[2][1],a=t[3][1],f=-0.5*s+1.5*o-1.5*u+.5*a,l=s-2.5*o+2*u-.5*a,c=-0.5*s+.5*u,h=o;return n[1]=f*r*i+l*i+c*r+h,n}},e.Curve.prototype.hermite={"P":function(e,t,n,r){var i=[0,0];i[0]=t[0][0]+(t[3][0]-t[0][0])*e;var s=r||0,o=n||0,u,a,f,l,c,h,p,d,v=e,m=t[0][1],g=t[1][1],y=t[2][1],b=t[3][1];return f=v*v,l=f*v,u=(g-m)*(1+s)*(1-o)/2,u+=(y-g)*(1-s)*(1-o)/2,a=(y-g)*(1+s)*(1-o)/2,a+=(b-y)*(1-s)*(1-o)/2,c=2*l-3*f+1,h=l-2*f+v,p=l-f,d=-2*l+3*f,i[1]=c*g+h*u+p*a+d*y,i}},e.Curve.prototype.bezier={"P":function(e,t){function r(e,t,r){var i=n;return typeof fact_lookup=="function"&&(i=fact_lookup),i(t)/(i(e)*i(t-e))*Math.pow(r,e)*Math.pow(1-r,t-e)}var n=function(e){var t=1;for(var n=2;n<=e;n++)t*=n;return t},i=[0,0],s=t.length-1;for(var o=0;o<=s;o++)i[0]+=t[o][0]*r(o,s,e),i[1]+=t[o][1]*r(o,s,e);return i}},e.Curve.prototype.genericCurve=function(e,t){function n(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function r(e){var t=0;for(var r=0;r<e.length-1;r++)t+=n(e[r],e[r+1]);var i=1/t;return i}function i(e,t){var n=r(e),i=[];for(var s=0;s<=1;s+=n){var o=t.P(s,e);i.push(o)}return i}this.supportPoints=i(e,this[t])},e.Curve.prototype.paintHandle=function(e,t,n){n===!0?this.paintPoint(e,t,this.terminalPointStyle,this.terminalPointFill,this.terminalPointColor,this.terminalPointSize):this.paintPoint(e,t,this.midPointStyle,this.midPointFill,this.midPointColor,this.midPointSize)},e.Curve.prototype.paintPoint=function(e,t,n,r,i,s){if(n==="rect")e.save(),e.strokeStyle=i,e.lineWidth=Math.round(s/5),e.strokeRect(t[0]-Math.round(s/2),t[1]-Math.round(s/2),s,s),r!==null&&(e.fillStyle=r,e.fillRect(t[0]-Math.ceil(s/2)+Math.floor(e.lineWidth/2),t[1]-Math.ceil(s/2)+Math.floor(e.lineWidth/2),s-e.lineWidth+1,s-e.lineWidth+1)),e.restore();else if(n==="circle")e.save(),e.beginPath(),e.strokeStyle=i,e.lineWidth=Math.round(s/5),e.arc(t[0],t[1],s,0,2*Math.PI,!1),r!==null&&(e.fillStyle=r,e.fill()),e.stroke(),e.restore();else if(n!=="none")throw"Unknown handle style: "+n},e.Curve.prototype.paintPoints=function(e,t){var n=this.values.points,r;e.save(),e.strokeStyle=this.helperColor,e.beginPath(),e.moveTo(n[0][0],n[0][1]);for(r=1;r<n.length;r++)e.lineTo(n[r][0],n[r][1]);e.stroke();for(r=0;r<n.length;r++){var i=!1;if(r===0||r===n.length-1)i=!0;var s=this.paintTerminalPoints;if(i===!0){if(s==="all"||s==="first"&&r===0||s==="last"&&r===n.length-1)this.paintHandle(e,n[r],i),this.curveLabels&&e.fillText(this.ID+" ("+r+")"+" ["+n[r][0]+","+n[r][1]+"]",n[r][0],n[r][1]-10)}else this.paintHandle(e,n[r],i),this.curveLabels&&e.fillText(this.ID+" ("+r+")"+" ["+n[r][0]+","+n[r][1]+"]",n[r][0],n[r][1]-10);e.restore()}},e.Curve.prototype.paintCurve=function(e){var t=this.supportPoints,n=this.thickness,r=this.curveColor;e.save(),e.lineWidth=n,e.strokeStyle=r,e.beginPath(),e.moveTo(t[0][0],t[0][1]);for(var i=1;i<t.length;i++)e.lineTo(t[i][0],t[i][1]);e.stroke(),e.restore()},e.Bar=function(e){arguments.length&&this.getready(e)},e.extend(e.Bar,e.UIElement),e.Bar.prototype.getready=function(t){e.Bar.superclass.getready.call(this,t),this.values={"barPos":[],"dragStart":[],"dragEnd":[]},this.defaultSlot="barPos",this.setWidth(t.width),this.setHeight(t.height),this.orientation=t.orientation||0,this.barColor=t.barColor||"black",this.thickness=t.thickness||1},e.Bar.prototype.isInROI=function(e,t){return e>this.ROILeft&&t>this.ROITop&&e<this.ROILeft+this.ROIWidth&&t<this.ROITop+this.ROIHeight?!0:!1},e.Bar.prototype.isInROIX=function(e){return e>this.ROILeft&&e<this.ROILeft+this.ROIWidth?!0:!1},e.Bar.prototype.isInROIY=function(e){return e>this.ROITop&&e<this.ROITop+this.ROIHeight?!0:!1},e.Bar.prototype.commonDrag=function(e,t){var n,r=this.values.barPos;if(this.orientation===0){if(!this.isInROIY(t))return;n=[e-this.xOrigin,r[1]],n[0]>this.width&&(n[0]=this.width),n[0]<0&&(n[0]=0)}else if(this.orientation===1){if(!this.isInROIY(e))return;n=[r[0],t-this.yOrigin],n[1]>this.height&&(n[1]=this.height),n[1]<0&&(n[1]=0)}return n},e.Bar.prototype.touch=function(e,t){if(!this.isInROI(e,t))return;this.started=!0;var n=this.commonDrag(e,t);if(typeof n!="undefined")return ret={"slot":"barPos","value":n},ret},e.Bar.prototype.drag=function(e,t){if(!this.started)return;var n=this.commonDrag(e,t);if(typeof n!="undefined")return ret={"slot":"barPos","value":n},ret},e.Bar.prototype.dragend=e.Bar.prototype.swipe=function(e,t){if(!this.started)return;this.started=!1;var n=this.commonDrag(e,t);if(typeof n!="undefined")return ret=[{"slot":"barPos","value":n},{"slot":"dragEnd","value":[e-this.xOrigin,t-this.yOrigin]}],ret},e.Bar.prototype.dragstart=function(e,t){if(this.isInROI(e,t))return ret={"slot":"dragStart","value":[e-this.xOrigin,t-this.yOrigin]},ret},e.Bar.prototype.setValue=function(e,t){console.log("Setting "+e+" to "+t),e=="barPos"?(t[0]<=this.width&&(this.values.barPos[0]=t[0]),t[1]<=this.height&&(this.values.barPos[1]=t[1])):this.values[e]=t},e.Bar.prototype.refresh_CANVAS2D=function(e){if(this.isVisible===!0){var t=e.context;t.lineWidth=this.thickness,t.strokeStyle=this.barColor,t.beginPath();if(this.orientation===0){var n=this.xOrigin+this.values.barPos[0];t.moveTo(n,this.yOrigin+this.height),t.lineTo(n,this.yOrigin)}else this.orientation===1&&(t.moveTo(this.xOrigin+this.width,this.yOrigin+this.values.barPos[1]),t.lineTo(this.xOrigin,this.yOrigin+this.values.barPos[1]));t.stroke(),t.closePath()}},e.Button=function(e){arguments.length&&this.getready(e)},e.extend(e.Button,e.UIElement),e.Button.prototype.getready=function(t){if(t===undefined)throw new Error("Error: args is undefined!");e.Button.superclass.getready.call(this,t),this.values={"buttonvalue":0},this.defaultSlot="buttonvalue",this.triggered=!1,this.mode=t.mode||"persistent",this.imagesArray=t.imagesArray;if(this.imagesArray.length<1)throw new Error("Invalid images array length, "+this.imagesArray.length);this.nButtons=this.imagesArray.length;for(var n=0;n<this.nButtons;n+=1)this.setWidth(this.imagesArray[n].width),this.setHeight(this.imagesArray[n].height)},e.Button.prototype.isInROI=function(e,t){return e>=this.ROILeft&&t>=this.ROITop&&e<=this.ROILeft+this.ROIWidth&&t<=this.ROITop+this.ROIHeight?!0:!1},e.Button.prototype.mousedown=e.Button.prototype.touchstart=function(e,t){if(this.isInROI(e,t)){this.triggered=!0;if(this.mode==="persistent")return undefined;if(this.mode==="immediate")return to_set=(this.values.buttonvalue+1)%this.nButtons,ret={"slot":"buttonvalue","value":to_set},ret}},e.Button.prototype.mouseup=e.Button.prototype.touchend=function(e,t){var n=0,r={};if(this.mode==="persistent"){if(this.triggered&&this.isInROI(e,t))return n=(this.values.buttonvalue+1)%this.nButtons,r={"slot":"buttonvalue","value":n},this.triggered=!1,r}else if(this.mode==="immediate"&&this.triggered)return n=(this.values.buttonvalue-1)%this.nButtons,r={"slot":"buttonvalue","value":n},this.triggered=!1,r;return undefined},e.Button.prototype.mouseout=function(e,t){if(this.mode==="immediate")return this.mouseup(e,t)},e.Button.prototype.setValue=function(t,n){if(n<0||n>this.nButtons)return;e.Button.superclass.setValue.call(this,t,n)},e.Button.prototype.refresh_CANVAS2D=function(e){this.isVisible===!0&&e.context.drawImage(this.imagesArray[this.values.buttonvalue],this.xOrigin,this.yOrigin)},e.Button.prototype.setStatesNumber=function(e){this.nButtons=e},e.Button.prototype.getStatesNumber=function(){return this.nButtons},e.Background=function(e){arguments.length&&this.getready(e)},e.extend(e.Background,e.UIElement),e.Background.prototype.getready=function(t){if(typeof t=="undefined")throw new Error("Error: args is undefined!");e.Background.superclass.getready.call(this,t),this.values={"selected":[],"held":[],"doubletap":[],"tap":[]},this.defaultSlot="selected",this.image=t.image,this.setWidth(this.image.width),this.setHeight(this.image.height)},e.Background.prototype.GetImage=function(){return this.image},e.Background.prototype.isInROI=function(e,t){if(e>this.ROILeft&&t>this.ROITop)return e<this.ROILeft+this.ROIWidth&&t<this.ROITop+this.ROIHeight?!0:!1},e.Background.prototype.mousedown=function(e,t){return this.isInROI(e,t)&&(this.triggered=!0),undefined},e.Background.prototype.mouseup=function(e,t){var n=0,r={};return this.triggered&&this.isInROI(e,t)?(r={"slot":"selected","value":[e,t]},this.triggered=!1,r):undefined},e.Background.prototype.refresh_CANVAS2D=function(e){this.isVisible===!0&&e.context.drawImage(this.image,this.xOrigin,this.yOrigin)},e.ClickBar=function(e){arguments.length&&this.getready(e)},e.extend(e.ClickBar,e.UIElement),e.ClickBar.prototype.getready=function(t){var n,r;e.ClickBar.superclass.getready.call(this,t),this.values={"barvalue":null},this.prevValue=null,this.defaultSlot="barvalue",this.color=t.color||"orangered",this.lightColor=t.diffColor||"darkorange",this.lighterColor=t.prevColor||"orange",this.lightestColor=t.prevColor||"#FFBE00",this.landingHeight=t.landingHeight||20;var i=t.height||0,s=t.width||0;this.maxValue=t.maxValue||1,this.minValue=t.minValue||0,this.setWidth(s),this.setHeight(i)},e.ClickBar.prototype.isInROI=function(e,t){console.log("y = ",t,"roitop = ",this.ROITop);if(e>=this.ROILeft&&t>=this.ROITop-this.landingHeight){console.log("1st");if(e<=this.ROILeft+this.ROIWidth&&t<=this.ROITop+this.ROIHeight+this.landingHeight)return console.log("In ROI!"),!0}return!1},e.ClickBar.prototype.calculateValue=function(e,t){var n=t-this.yOrigin;console.log("heigth on click is ",n," pixels");var r=1-n/this.height;return console.log("for a value of ",r," (",n," / ",this.height,")"),r>this.maxValue&&(r=this.maxValue),r<this.minValue&&(r=this.minValue),r},e.ClickBar.prototype.tap=e.ClickBar.prototype.touchstart=e.ClickBar.prototype.mousedown=function(e,t){if(this.isInROI(e,t)){this.triggered=!0;var n=this.calculateValue(e,t);if(n===this.values.barvalue)return;return{"slot":"barvalue","value":n}}},e.ClickBar.prototype.drag=function(e,t){if(this.isInROI(e,t)){this.triggered||(this.prevValue=this.values.barvalue,this.triggered=!0);var n=this.calculateValue(e,t);if(n===this.values.barvalue)return;return{"slot":"barvalue","value":n}}},e.ClickBar.prototype.release=e.ClickBar.prototype.dragend=e.ClickBar.prototype.mouseup=function(e,t){this.triggered=!1;if(this.prevValue!==this.values.barvalue)return this.prevValue=this.values.barvalue,{"slot":"barvalue","value":this.values.barvalue}},e.ClickBar.prototype.setValue=function(t,n){e.ClickBar.superclass.setValue.call(this,t,n)},e.ClickBar.prototype.refresh_CANVAS2D=function(e){this.isVisible===!0&&(this.triggered?this.values.barvalue<this.prevValue?(e.context.fillStyle=this.lightestColor,e.context.fillRect(this.xOrigin,this.yOrigin+(1-this.prevValue)*this.height,this.width,this.prevValue*this.height),e.context.fillStyle=this.lightColor,e.context.fillRect(this.xOrigin,this.yOrigin+(1-this.values.barvalue)*this.height,this.width,this.values.barvalue*this.height)):(e.context.fillStyle=this.lightColor,e.context.fillRect(this.xOrigin,this.yOrigin+(1-this.values.barvalue)*this.height,this.width,this.values.barvalue*this.height),e.context.fillStyle=this.lighterColor,e.context.fillRect(this.xOrigin,this.yOrigin+(1-this.prevValue)*this.height,this.width,this.prevValue*this.height)):(e.context.fillStyle=this.color,e.context.fillRect(this.xOrigin,this.yOrigin+(1-this.values.barvalue)*this.height,this.width,this.values.barvalue*this.height)))},e.Gauge=function(e){arguments.length&&this.getready(e)},e.extend(e.Gauge,e.UIElement),e.Gauge.prototype.getready=function(t){if(typeof t=="undefined")throw new Error("Error: args is undefined!");e.Gauge.superclass.getready.call(this,t),this.values={"gaugevalue":null,"midgaugevalue":null,"selected":[],"held":[],"doubletap":[],"tap":[]},this.defaultSlot="gaugevalue",this.prevValue=this.values.gaugevalue,this.setWidth(t.width),this.setHeight(t.height),this.color=t.color||["#47D147","#70DB70","#99E699"],this.bgColor=t.bgColor||"#222",this.radius=t.radius||(this.width<this.height?Math.floor(this.width/2):Math.floor(this.height/2)),this.thickness=t.thickness||(this.width<this.height?Math.floor(this.width/3):Math.floor(this.height/3)),this.animationInterval=null},e.Gauge.prototype.isInROI=function(e,t){return!0},e.Gauge.prototype.calculateAngle=function(t,n){var r=this.xOrigin+this.width/2,i=this.yOrigin+this.height/2;console.log("Point is: ",t,n,"Center is: ",r,i);var s=Math.atan2(t-r,n-i);console.log("radiant atan ",s);var o=s*(180/Math.PI);o=180-o,console.log("degree atan ",o);var u=e.MathUtils.linearRange(0,360,0,1,Math.floor(o));return u},e.Gauge.prototype.tap=e.Gauge.prototype.mousedown=e.Gauge.prototype.touchstart=function(t,n){var r=e.MathUtils.distance(t,n,this.xOrigin+this.width/2,this.yOrigin+this.height/2);console.log("dist is, ",r," radius is ",this.radius," thickness is ",this.thickness);if(r>this.radius-this.thickness/2&&r<this.radius+this.thickness/2){console.log("down / tapped Inside the dial"),this.triggered=!0;var i=this.calculateAngle(t,n);this.prevValue=this.values.gaugevalue;var s={"slot":"gaugevalue","value":i};return s}return undefined},e.Gauge.prototype.drag=e.Gauge.prototype.mousemove=function(e,t){if(this.triggered){console.log("triggered mousemove");var n=this.calculateAngle(e,t),r={"slot":"gaugevalue","value":n};return r}},e.Gauge.prototype.release=e.Gauge.prototype.dragend=e.Gauge.prototype.mouseup=function(e,t){if(this.triggered){this.triggered=!1,this.prevValue=this.values.gaugevalue;var n={"slot":"gaugevalue","value":this.values.gaugevalue};return n}},e.Gauge.prototype.setValue=function(t,n){e.Gauge.superclass.setValue.call(this,t,n)},e.Gauge.prototype.refresh_CANVAS2D=function(e){if(this.isVisible===!0){var t=e.context;t.beginPath(),this.drawGauge(t,1,this.bgColor),this.triggered?this.values.gaugevalue<=this.prevValue?(this.drawGauge(t,this.prevValue,this.color[2]),this.drawGauge(t,this.values.gaugevalue,this.color[1])):(this.drawGauge(t,this.values.gaugevalue,this.color[2]),this.drawGauge(t,this.prevValue,this.color[1])):this.drawGauge(t,this.values.gaugevalue,this.color[0])}},e.Gauge.prototype.drawGauge=function(t,n,r){var i,s;i=e.MathUtils.linearRange(0,1,0,360,n),s=i*Math.PI/180,t.beginPath(),t.strokeStyle=r,t.lineWidth=this.thickness,n===1?t.arc(this.xOrigin+this.width/2,this.yOrigin+this.height/2,this.radius,0,Math.PI*2,!1):t.arc(this.xOrigin+this.width/2,this.yOrigin+this.height/2,this.radius,-90*Math.PI/180,s-90*Math.PI/180,!1),t.stroke()},e.Grid=function(e){arguments.length&&this.getready(e)},e.extend(e.Grid,e.UIElement),e.Grid.prototype.getready=function(t){if(t===undefined)throw new Error("Error: args is undefined!");e.Grid.superclass.getready.call(this,t),this.setWidth(t.width),this.setHeight(t.height),this.values={"selected":[]},this.defaultSlot="",this.triggered=!1,this.rows=t.rows||4,this.columns=t.columns||4,this.style=t.style||"line",this.lineColor=t.lineColor||"#eee",this.bgColor=t.bgColor||"white",this.dashArray=t.dashArray,this.lineWidth=t.lineWidth||.1;if(this.rows<0||this.columns<0)throw new Error("Invalid number of row / columns "+this.rows+" / "+this.columns)},e.Grid.prototype.isInROI=function(e,t){return e>=this.ROILeft&&t>=this.ROITop&&e<=this.ROILeft+this.ROIWidth&&t<=this.ROITop+this.ROIHeight?!0:!1},e.Grid.prototype.mousedown=function(e,t){return this.isInROI(e,t)&&(this.triggered=!0),undefined},e.Grid.prototype.mouseup=function(e,t){return this.triggered&&this.isInROI(e,t)?(this.triggered=!1,{"slot":"selected","value":[e,t]}):undefined},e.Grid.prototype.setValue=function(t,n){e.Grid.superclass.setValue.call(this,t,n)},e.Grid.prototype.refresh_CANVAS2D=function(e){if(this.isVisible===!0){var t=e.context,n=Math.floor(this.height/this.rows),r=Math.floor(this.width/this.columns);t.fillStyle=this.bgColor,t.fillRect(this.xOrigin,this.yOrigin,this.width,this.height),t.beginPath(),t.lineWidth=this.lineWidth;for(var i=this.xOrigin+0;i<this.xOrigin+this.width;i+=r)this.style==="line"?(t.moveTo(i,this.yOrigin),t.lineTo(i,this.yOrigin+this.height)):this.style==="dashed"&&t.dashedLine(i,this.yOrigin,i,this.yOrigin+this.height,this.dashArray);for(var s=this.yOrigin+0;s<this.yOrigin+this.height;s+=n)this.style==="line"?(t.moveTo(this.xOrigin,s),t.lineTo(this.xOrigin+this.width,s)):this.style==="dashed"&&t.dashedLine(this.xOrigin,s,this.xOrigin+this.width,s,this.dashArray);t.strokeStyle=this.lineColor,t.stroke(),t.closePath()}},e.Knob=function(e){arguments.length&&this.getready(e)},e.extend(e.Knob,e.UIElement),e.Knob.prototype.getready=function(t){if(t===undefined)throw new Error("Error: specArgs is undefined!");e.Knob.superclass.getready.call(this,t),this.values={"knobvalue":0},this.defaultSlot="knobvalue",this.sensitivity=t.sensitivity||2e3,this.imagesArray=t.imagesArray||null,this.knobMethod=t.knobMethod||"atan",this.bottomAngularOffset=t.bottomAngularOffset;var n=0,r=0;if(this.imagesArray.length<1)throw new Error("Invalid images array length, "+this.imagesArray.length);if(this.imagesArray.length==1)n=t.tileWidth,r=t.tileHeight,this.imageNum=t.imageNum;else{this.imageNum=this.imagesArray.length;for(var i=0,s=this.imagesArray.length;i<s;i+=1)this.imagesArray[i].width>n&&(n=this.imagesArray[i].width),this.imagesArray[i].height>r&&(r=this.imagesArray[i].height)}this.setWidth(n),this.setHeight(r)},e.Knob.prototype.getImageNum=function(){if(this.values.knobvalue<0||this.values.knobvalue>1)return undefined;var e=Math.round(this.values.knobvalue*(this.imageNum-1));return e},e.Knob.prototype.getImage=function(){var e=this.getImageNum();return this.imagesArray[e]},e.Knob.prototype.calculateAngle=function(t,n){var r=this.xOrigin+this.width/2,i=this.yOrigin+this.height/2;console.log("Point is: ",t,n,"Center is: ",r,i);var s=Math.atan2(t-r,n-i);console.log("radiant atan ",s),s<0&&(s+=2*Math.PI),console.log("radiant atan, normalized, is ",s);var o=s*(180/Math.PI);console.log("degree atan is",o),o=360-o,typeof this.bottomAngularOffset!="undefined"&&(o=e.MathUtils.linearRange(0,360,-this.bottomAngularOffset,360+this.bottomAngularOffset,o),o<0&&(o=0),o>360&&(o=360));var u=e.MathUtils.linearRange(0,360,0,1,Math.floor(o));return console.log("value is",u),u},e.Knob.prototype.isInROI=function(e,t){return e>this.ROILeft&&t>this.ROITop&&e<this.ROILeft+this.ROIWidth&&t<this.ROITop+this.ROIHeight?!0:!1},e.Knob.prototype.dragstart=e.Knob.prototype.mousedown=e.Knob.prototype.touchstart=function(e,t){var n=this.isInROI(e,t);if(n){this.start_x=e,this.start_y=t;if(this.knobMethod==="atan"){var r=this.calculateAngle(e,t),i={"slot":"knobvalue","value":r};return i}}return undefined},e.Knob.prototype.dragend=e.Knob.prototype.mouseup=function(e,t){return this.start_x=undefined,this.start_y=undefined,undefined},e.Knob.prototype.drag=e.Knob.prototype.mousemove=function(e,t){var n;if(this.knobMethod==="updown"){if(this.start_x!==undefined&&this.start_y!==undefined){var r=0,i,s;return r=t-this.start_y,i=this.values.knobvalue,s=i-r/this.sensitivity,s>1&&(s=1),s<0&&(s=0),n={"slot":"knobvalue","value":s},n}}else if(this.knobMethod==="atan"&&this.start_x!==undefined&&this.start_y!==undefined){var o=this.calculateAngle(e,t);return n={"slot":"knobvalue","value":o},n}return undefined},e.Knob.prototype.setValue=function(t,n){var r=n;if(r<0||r>1)return;e.Knob.superclass.setValue.call(this,t,n)},e.Knob.prototype.refresh_CANVAS2D=function(e){if(this.isVisible===!0)if(this.imagesArray.length>1){var t=this.getImageNum();e.context.drawImage(this.imagesArray[t],this.xOrigin,this.yOrigin)}else if(this.imagesArray.length==1){var n=0,r=this.height*this.getImageNum();e.context.drawImage(this.imagesArray[0],n,r,this.width,this.height,this.xOrigin,this.yOrigin,this.width,this.height)}},e.Label=function(e){arguments.length&&this.getready(e)},e.extend(e.Label,e.UIElement),e.Label.prototype.getready=function(t){e.Label.superclass.getready.call(this,t),this.values={"labelvalue":""},this.defaultSlot="labelvalue",this.textColor=t.textColor||"black",this.setWidth(t.width),this.setHeight(t.height)},e.Label.prototype.isInROI=function(e,t){return e>this.ROILeft&&t>this.ROITop&&e<this.ROILeft+this.ROIWidth&&t<this.ROITop+this.ROIHeight?!0:!1},e.Label.prototype.setValue=function(t,n){e.Label.superclass.setValue.call(this,t,n)},e.Label.prototype.refresh_CANVAS2D=function(e){var t;this.isVisible===!0&&(typeof this.objParms!="undefined"&&(typeof this.objParms.textBaseline!="undefined"&&(e.context.textBaseline=this.objParms.textBaseline),typeof this.objParms.textAlign!="undefined"&&(e.context.textAlign=this.objParms.textAlign),typeof this.objParms.font!="undefined"&&(e.context.font=this.objParms.font)),e.context.fillStyle=this.textColor,e.context.fillText(this.values.labelvalue,this.xOrigin,this.yOrigin))},e.RotKnob=function(e){arguments.length&&this.getready(e)},e.extend(e.RotKnob,e.UIElement),e.RotKnob.prototype.getready=function(t){if(typeof t=="undefined")throw"RotKnob constructor: args is undefined!";e.RotKnob.superclass.getready.call(this,t),this.values={"knobvalue":0,"realknobvalue":0},this.defaultSlot="knobvalue",t.initAngValue===undefined?this.initAngValue=0:this.initAngValue=t.initAngValue,t.moveDirection=="anticlockwise"?this.moveDirection=-1:this.moveDirection=1,this.startAngValue=t.startAngValue||0,this.stopAngValue=t.stopAngValue||360,this.angSteps=t.angSteps;var n=t.sensitivity||2e3;this.sensitivity=Math.round(n/360*Math.abs(this.stopAngValue-this.startAngValue)),this.knobMethod=t.knobMethod||"atan",this.image=t.image,this.setWidth(this.image.width),this.setHeight(this.image.height),this.start_x=null,this.start_y=null},e.RotKnob.prototype.getRotateAmount=function(){if(this.values.knobvalue<0||this.values.knobvalue>1)return undefined;var e=this.values.knobvalue*360,t=360-(e*(this.startAngValue-this.stopAngValue)/360+this.stopAngValue)%360,n=(360-this.initAngValue+t)%360,r=n*Math.PI/180;return r},e.RotKnob.prototype.getRangedAmount=function(t){var n=this.stopAngValue-this.initAngValue,r=this.startAngValue-this.initAngValue;console.log("start -> end",r,n),t>this.initAngValue&&r<0&&(console.log("Angle now is",t),t=-(360-t));var i=e.MathUtils.linearRange(r,n,0,1,t);return console.log("knob value",i),i<0&&(i=0),i>1&&(i=1),i},e.RotKnob.prototype.isInROI=function(e,t){return e>this.ROILeft&&t>this.ROITop&&e<this.ROILeft+this.ROIWidth&&t<this.ROITop+this.ROIHeight?!0:!1},e.RotKnob.prototype.calculateAngle=function(e,t){var n=this.xOrigin+this.width/2,r=this.yOrigin+this.height/2;console.log("Point is: ",e,t,"Center is: ",n,r);var i=Math.atan2(e-n,t-r);console.log("radiant atan ",i);var s=i*(180/Math.PI);s=180-s;var o=s-this.initAngValue;o<0&&(o=360+o);var u=(s-this.initAngValue)%360;console.log("degreetan -> offset",s,o,u);var a=this.getRangedAmount(Math.floor(o));return a},e.RotKnob.prototype.dragstart=e.RotKnob.prototype.mousedown=e.RotKnob.prototype.touchstart=function(e,t){var n=this.isInROI(e,t);if(n){this.start_x=e,this.start_y=t;if(this.knobMethod==="atan"){var r=this.calculateAngle(e,t),i={"slot":"knobvalue","value":r};return i}}return undefined},e.RotKnob.prototype.dragend=e.RotKnob.prototype.mouseup=e.RotKnob.prototype.touchend=function(e,t){return this.start_x=null,this.start_y=null,undefined},e.RotKnob.prototype.drag=e.RotKnob.prototype.mousemove=function(e,t){var n;if(this.knobMethod==="updown"){if(this.start_x!==null&&this.start_y!==null){var r=0,i,s;return r=t-this.start_y,i=this.values.realknobvalue,s=i-r/this.sensitivity*this.moveDirection,s>1&&(s=1),s<0&&(s=0),n={"slot":"knobvalue","value":s},n}}else if(this.knobMethod==="atan"&&this.isInROI(e,t)&&this.start_x!==null&&this.start_y!==null){var o=this.calculateAngle(e,t);return n={"slot":"knobvalue","value":o},n}return undefined},e.RotKnob.prototype.setValue=function(t,n){var r;if(n<0||n>1)return;if(this.values[t]===undefined)throw new Error("Slot "+t+" not present or value undefined");if(n===this.values[t]||n===this.values["real"+t])return;this.values["real"+t]=n;if(this.angSteps!==undefined){var i=1/this.angSteps;r=Math.floor(n/i)*i;if(r===this.values[t])return}else r=n;console.log("Value is: ",r),e.RotKnob.superclass.setValue.call(this,t,r)},e.RotKnob.prototype.refresh_CANVAS2D=function(t){if(this.isVisible===!0){var n=this.getRotateAmount();e.CanvasUtils.drawRotate(t.context,{"image":this.image,"x":this.xOrigin,"y":this.yOrigin,"rot":n})}},e.Slider=function(e){arguments.length&&this.getready(e)},e.extend(e.Slider,e.UIElement),e.Slider.prototype.getready=function(t){if(typeof t=="undefined")throw"Slider error: args is undefined!";e.Slider.superclass.getready.call(this,t),this.values={"slidervalue":0},this.defaultSlot="slidervalue",this.width=0,this.height=0,this.sliderImage=t.sliderImg,this.knobImage=t.knobImg,this.type=t.type,this.type!=="horizontal"&&this.type!=="vertical"&&(this.type="vertical"),this.calculateDimensions()},e.Slider.prototype.getKnobPosition=function(){var e;if(this.values.slidervalue<0||this.values.slidervalue>1)return undefined;switch(this.type){case"horizontal":e=Math.round(this.values.slidervalue*this.width+this.zeroLimit);break;case"vertical":e=Math.round(this.values.slidervalue*this.height+this.zeroLimit);break;default:throw new Error("Error: Slider orientation is undefined!")}return e},e.Slider.prototype.isInROI=function(e,t){switch(this.type){case"horizontal":if(e>this.getKnobPosition()&&t>this.ROITop&&e<this.getKnobPosition()+this.kWidth&&t<this.ROITop+this.kHeight)return!0;break;case"vertical":if(t>this.getKnobPosition()&&e>this.ROILeft&&t<this.getKnobPosition()+this.kHeight&&e<this.ROILeft+this.kWidth)return!0;break;default:throw new Error("Error: Slider orientation is undefined!")}return!1},e.Slider.prototype.dragstart=e.Slider.prototype.mousedown=function(e,t){if(this.isInROI(e,t)){this.triggered=!0;switch(this.type){case"horizontal":this.drag_offset=e-this.getKnobPosition();break;case"vertical":this.drag_offset=t-this.getKnobPosition();break;default:throw new Error("Error: Slider orientation is undefined!")}}return undefined},e.Slider.prototype.dragend=e.Slider.prototype.mouseup=function(e,t){return this.triggered=!1,this.drag_offset=undefined,undefined},e.Slider.prototype.drag=e.Slider.prototype.mousemove=function(e,t){if(this.triggered===!0){var n,r;switch(this.type){case"horizontal":n=(e-this.zeroLimit-this.drag_offset)/this.width;break;case"vertical":n=(t-this.zeroLimit-this.drag_offset)/this.height;break;default:throw new Error("Error: Slider orientation is undefined!")}return n>1&&(n=1),n<0&&(n=0),r={"slot":"slidervalue","value":n},r}return undefined},e.Slider.prototype.setValue=function(t,n){if(n<0||n>1)return;e.Slider.superclass.setValue.call(this,t,n)},e.Slider.prototype.refresh_CANVAS2D=function(e){if(this.isVisible===!0){e.context.drawImage(this.sliderImage,this.xOrigin,this.yOrigin);switch(this.type){case"horizontal":e.context.drawImage(this.knobImage,this.getKnobPosition(),this.yOrigin);break;case"vertical":e.context.drawImage(this.knobImage,this.xOrigin,this.getKnobPosition());break;default:throw new Error("Error: Slider orientation unknown: ",this.type)}}},e.Slider.prototype.calculateDimensions=function(){this.kWidth=this.knobImage.width,this.kHeight=this.knobImage.height,this.setWidth(this.sliderImage.width),this.setHeight(this.sliderImage.height);switch(this.type){case"horizontal":this.totalStride=this.width+this.kWidth,this.additionalEndSpace=Math.round(this.kWidth/2),this.zeroLimit=this.xOrigin-this.additionalEndSpace,this.oneLimit=this.xOrigin+this.width+this.additionalEndSpace;break;case"vertical":this.totalStride=this.height+this.kHeight,this.additionalEndSpace=Math.round(this.kHeight/2),this.zeroLimit=this.yOrigin-this.additionalEndSpace,this.oneLimit=this.yOrigin+this.height+this.additionalEndSpace;break;default:throw new Error("Error: Slider orientation is undefined!")}},e.Slider.prototype.setGraphicWrapper=function(t){e.Slider.superclass.setGraphicWrapper.call(this,t),this.drawClass=t.initObject([{"objName":"drawImage","objParms":this.objParms}])},e.Wavebox=function(e){arguments.length&&this.getready(e)},e.extend(e.Wavebox,e.UIElement),e.Wavebox.prototype.getready=function(t){e.Wavebox.superclass.getready.call(this,t),this.values={"waveboxposition":0,"startsample":0,"endsample":null,"waveboxsignal":[],"xPos":0,"yPos":0},this.defaultSlot="waveboxposition",this.setWidth(t.width),this.setHeight(t.height),this.binMethod=t.binMethod||"minmax",this.orientation=t.orientation||0,this.waveColor=t.waveColor||"black"},e.Wavebox.prototype.isInROI=function(e,t){return e>this.ROILeft&&t>this.ROITop&&e<this.ROILeft+this.ROIWidth&&t<this.ROITop+this.ROIHeight?!0:!1},e.Wavebox.prototype.tap=e.Wavebox.prototype.mousedown=function(e,t){return this.isInROI(e,t)&&(this.triggered=!0),undefined},e.Wavebox.prototype.release=e.Wavebox.prototype.mouseup=function(e,t){var n=0,r={};return this.triggered&&this.isInROI(e,t)?(this.orientation===0?r={"slot":"xPos","value":e}:this.orientation===1?r={"slot":"yPos","value":t}:console.error("orientation invalid, this will probably break something"),this.triggered=!1,r):undefined},e.Wavebox.prototype.setValue=function(e,t){console.log("Setting "+e+" to "+t);if(this.values[e]===undefined)throw new Error("Slot "+e+" not present or value undefined");if(this.values[e]===t)return;if(e==="startsample"||e==="endsample"){if(t<0)throw new Error("Error: Trying to set ",e," less than 0: ",t);if(typeof this.values.waveboxsignal!="undefined"&&t>this.values.waveboxsignal.length)throw new Error("Error: Trying to set ",e," bigger than signal length: ",t," > ",this.values.waveboxsignal.length)}if(e==="startsample"&&t>this.values.endsample)throw new Error("Error: Trying to set startsample > endsample: ",t," > ",this.values.endsample);if(e==="endsample"&&t<this.values.startample)throw new Error("Error: Trying to set endsample < startsample: ",t," < ",this.values.startsample);this.values[e]=t,e==="waveboxsignal"&&(this.values.endsample=this.values.waveboxsignal.length,this.values.startsample=0),e=="xPos"&&t<=this.width&&(this.values.xPos=t),e=="yPos"&&(t<=this.height?(console.log("Setting yPos to "+t),this.values.yPos=t):console.log("NOT setting yPos to "+t+" because height is "+this.height))},e.Wavebox.prototype.refresh_CANVAS2D=function(e){if(this.isVisible===!0){var t=e.context;t.fillStyle=this.waveColor;var n,r,i,s,o=this.width,u=this.height;this.orientation===1&&(o=this.height,u=this.width);var a;this.binMethod=="minmax"?a=this.calculateBinMix:this.binMethod=="none"?a=this.calculateBinNone:console.log("Error: no binMethod!");var f=0;i=parseInt((this.values.endsample-this.values.startsample)/o,10),t.beginPath(),this.orientation===0?t.moveTo(this.xOrigin,u*.5+this.yOrigin):this.orientation===1&&t.moveTo(this.xOrigin+u*.5,this.yOrigin);for(f=0;f<o;f+=1)s=a(f,i,this.values),this.orientation===0?(n=u-(s.max+1)*u/2+this.yOrigin,r=f+this.xOrigin):this.orientation===1&&(n=f+this.yOrigin,r=u-(s.max+1)*u/2+this.xOrigin),t.lineTo(r,n);this.orientation===0?t.lineTo(o+this.xOrigin,u*.5+this.yOrigin):this.orientation===1&&t.lineTo(u*.5+this.xOrigin,o+this.yOrigin),t.fill(),t.closePath(),t.beginPath(),this.orientation===0?t.moveTo(this.xOrigin,u*.5+this.yOrigin):this.orientation===1&&t.moveTo(this.xOrigin+u*.5,this.yOrigin);for(f=0;f<o;f+=1)s=a(f,i,this.values),this.orientation===0&&(n=u-(s.min+1)*u/2+this.yOrigin,r=f+this.xOrigin),this.orientation===1&&(n=f+this.yOrigin,r=u-(s.min+1)*u/2+this.xOrigin),t.lineTo(r,n);this.orientation===0?t.lineTo(o+this.xOrigin,u*.5+this.yOrigin):this.orientation===1&&t.lineTo(u*.5+this.xOrigin,o+this.yOrigin),t.fill(),t.closePath()}},e.Wavebox.prototype.calculateBinMix=function(e,t,n){var r=n.waveboxsignal,i=n.startsample+e*t,s=n.startsample+(e+1)*t;s>n.endsample&&(s=n.endsample);var o=r[i],u=r[i];for(var a=1;a<t;a++)r[i+a]<o&&(o=r[i+a]),r[i+a]>u&&(u=r[i+a]);var f={"max":u,"min":o};return f},e.Wavebox.prototype.calculateBinNone=function(e,t,n){var r=n.startsample+e*t,i=parseInt(t/2,10),s=n.waveboxsignal[r+i],o={"max":s,"min":-s};return o},e.Wavebox.prototype.calculateBinAvg=function(e,t){var n=this.values.waveboxsignal,r=this.values.startsample+e*t,i=r+(e+1)*t;i>this.values.endsample&&(i=this.values.endsample);var s=n.subarray(r,i),o=0,u=s.length;for(var a=0;a<u-1;a++)o=(s[a+1]+a*o)/(a+1);return o};var t=function(t){this.setVisible=function(e){for(var t=0;t<this.status.curveArray.length;t+=1)this.ui.setVisible(this.status.curveArray[t],e)},this.setzIndex=function(e){this.Z_OFFSET=e,this.reorganizeElements(),this.ui.refresh()},this.setTransparency=function(e){for(var t=0;t<this.status.curveArray.length;t+=1){var n=this.ui.getElement(this.status.curveArray[t]);n.transparency=e}this.ui.refresh()},this.setListening=function(e){for(var t=0;t<this.status.curveArray.length;t+=1)this.ui.setListening(this.status.curveArray[t],e)},this.reorganizeElements=function(){var t=function(t,n){var r=e.GenericUtils.clone(n.ui.getProp(n.recv,"values").points),i=e.GenericUtils.clone(n.ui.getProp(n.sender,"values").points);return r[r.length-1]=i[0],r};this.ui.resetSlots();for(var n=0;n<this.status.curveArray.length;n+=1)this.ui.setZIndex(this.status.curveArray[n],n+this.Z_OFFSET),n<this.status.curveArray.length-1&&this.ui.connectSlots(this.status.curveArray[n+1],"points",this.status.curveArray[n],"points",{"callback":t,"cascade":!1});if(this.xMonotone)for(n=0;n<this.status.curveArray.length-1;n+=1){var r=this.ui.getElement(this.status.curveArray[n]),i=this.ui.getElement(this.status.curveArray[n+1]);r.ROIWidth=i.values.points[0][0]-r.ROILeft,i.ROILeft=r.values.points[0][0]}},this.callback=function(){var t=this;return function(n,r,i){console.log("Element: ",i,". onValueSet callback: slot is ",n," and value is ",r," while that is ",t),typeof t.externalCallback=="function"&&t.externalCallback(n,r,i);if(n==="selected")for(var s=0;s<t.status.curveArray.length;s+=1)t.status.curveArray[s]===i?(t.ui.setProp(i,"curveColor",t.selectedCurveColor),t.status.selected=s):t.ui.setProp(t.status.curveArray[s],"curveColor",t.curveArgsTemplate.curveColor);n==="held";if(n==="doubletap_c"){var o=t.ui.getProp(i,"values").points,u=e.GenericUtils.clone(t.curveArgsTemplate);u.curveType="linear",u.ID="curve"+t.status.nextNumber++;if(t.status.selected<t.status.curveArray.length-1){u.paintTerminalPoints="first",o[o.length-1]=r;var a=t.status.curveArray[t.status.selected+1],f=t.ui.getProp(a,"values").points;u.points=[r[0],r[1],f[0][0],f[0][1]]}else{t.ui.setProp(i,"paintTerminalPoints","first"),u.paintTerminalPoints="all";var l=e.GenericUtils.clone(o[o.length-1]);o[o.length-1]=r,u.points=[r[0],r[1],l[0],l[1]]}var c=new e.Curve(u);t.ui.addElement(c),t.status.curveArray.splice(t.status.selected+1,0,u.ID)}console.log("Reorganizing elements"),t.reorganizeElements(),t.ui.refresh()}},this.clearCurve=function(){for(var e=0;e<this.status.curveArray.length;e+=1)this.ui.removeElement(this.status.curveArray[e]);this.status.curveArray=[],this.status.selected=null,this.ui.refresh()},this.addCurve=function(t,n,r,i){console.log("Adding a curve");var s,o=e.GenericUtils.clone(this.curveArgsTemplate);o.ID="curve"+this.status.nextNumber++;var u=n,a,f,l=[];o.paintTerminalPoints="all";if(typeof r!="undefined")a=r;else if(this.status.curveArray.length===0)a=[0,this.height];else{s=this.status.curveArray[this.status.curveArray.length-1];var c=this.ui.getProp(s,"values").points;a=[c[c.length-1][0],c[c.length-1][1]],this.ui.setProp(s,"paintTerminalPoints","first")}var h=Math.round(this.width/8),p=-Math.round(this.height/8);if(typeof i!="undefined")f=i;else{f=[a[0]+h,a[1]+p],f[0]>this.width&&(f[0]=this.width),f[1]<0&&(f[1]=0);if(f[0]===this.lastCalculatedPoint[0]&&f[1]===this.lastCalculatedPoint[1]){console.log("Remove something before adding stuff"),this.ui.setProp(s,"paintTerminalPoints","all");return}}this.lastCalculatedPoint[0]=f[0],this.lastCalculatedPoint[1]=f[1];switch(t){case"linear":case"smooth":case"halfcosine":o.points=a.concat(f);break;case"bezier":var d=a.slice();for(var v=1;v<u;v+=1)d[0]+=20,d[1]-=20,l=l.concat(d);o.points=a.concat(l,f)}o.curveType=t;var m=new e.Curve(o);this.ui.addElement(m),this.status.curveArray.push(o.ID),this.reorganizeElements(),this.ui.refresh()},this.removeCurve=function(){var t;if(this.status.selected!==null){console.log("Deleting selected curve "+this.status.selected);if(this.status.selected!==0&&this.status.selected<this.status.curveArray.length-1){var n=this.status.curveArray[this.status.selected+1];t=this.status.curveArray[this.status.selected-1];var r=this.ui.getProp(n,"values"),i=this.ui.getProp(t,"values"),s=e.GenericUtils.clone(r);s.points[0][0]=i.points[i.points.length-1][0],s.points[0][1]=i.points[i.points.length-1][1],this.ui.setProp(n,"values",s)}this.status.selected===this.status.curveArray.length-1&&this.status.selected!==0&&(t=this.status.curveArray[this.status.selected-1],this.ui.setProp(t,"paintTerminalPoints","all")),this.ui.removeElement(this.status.curveArray[this.status.selected]),this.status.curveArray.splice(this.status.selected,1),this.status.selected=null,this.reorganizeElements(),this.ui.refresh()}},this.modifyCurve=function(t,n){var r;if(this.status.selected!==null){console.log("Transforming selected curve "+this.status.selected);var i=n,s=this.ui.getProp(this.status.curveArray[this.status.selected],"curveType"),o=e.GenericUtils.clone(this.ui.getProp(this.status.curveArray[this.status.selected],"values")),u=o.points,a=u.length-1;if(s===t){if(t!=="bezier"){console.log("Identical type, doing nothing");return}if(i===a){console.log("Identical type and grade, doing nothing");return}}var f=u[0],l=[],c=[f[0],f[1]];if(t==="bezier")for(r=1;r<i;r+=1)c[0]+=20,c[1]-=20,l=l.concat(c);var h=u[u.length-1],p=f.concat(l,h),d=[];for(r=0;r<p.length;r+=2)d.push([p[r],p[r+1]]);o.points=d,this.ui.setProp(this.status.curveArray[this.status.selected],"curveType",t),this.ui.setProp(this.status.curveArray[this.status.selected],"values",o),this.reorganizeElements(),this.ui.refresh()}},this.ui=t.ui,this.plugin_canvas=t.canvas,this.status={"curveArray":[],"selected":null,"nextNumber":0},this.Z_OFFSET=t.zOffset||0,this.width=t.width||t.canvas.width,this.height=t.height||t.canvas.height,this.lastCalculatedPoint=[],this.selectedCurveColor=t.selectedCurveColor||"red",this.externalCallback=t.callback,this.xMonotone=t.xMonotone,this.curveArgsTemplate={"ID":"","top":0,"left":0,"width":this.width,"height":this.height,"thickness":t.thickness||5,"curveColor":t.curveColor||"02B51F","handleColor":t.handleColor||"A81B32","helperColor":t.helperColor||"gray","curveLabels":t.curveLabels||!0,"midPointSize":t.midPointSize||8,"terminalPointSize":t.terminalPointSize||15,"terminalPointColor":t.terminalPointColor||"black","terminalPointFill":t.terminalPointFill||"015C10","midPointFill":t.midPointFill||"E6965A","isListening":t.isListening||!0,"transparency":t.transparency||.8,"xMonotone":t.xMonotone,"onValueSet":this.callback()}},n=function(t){this.reorganizeElements=function(){var t=function(t,n){var r=e.GenericUtils.clone(n.ui.getProp(n.recv,"values").points),i=e.GenericUtils.clone(n.ui.getProp(n.sender,"values").points);return r[r.length-1]=i[0],r};this.ui.resetSlots();for(var n=0;n<this.status.areaArray.length;n+=1)this.ui.setZIndex(this.status.areaArray[n],n+this.Z_OFFSET),n<this.status.areaArray.length-1&&this.ui.connectSlots(this.status.areaArray[n+1],"points",this.status.areaArray[n],"points",{"callback":t,"cascade":!1});if(this.xMonotone)for(n=0;n<this.status.areaArray.length-1;n+=1){var r=this.ui.getElement(this.status.areaArray[n]),i=this.ui.getElement(this.status.areaArray[n+1]);r.ROIWidth=i.values.points[0][0]-r.ROILeft,i.ROILeft=r.values.points[0][0]}},this.callback=function(){var t=this;return function(n,r,i){console.log("Element: ",i,". onValueSet callback: slot is ",n," and value is ",r," while that is ",t),typeof t.externalCallback=="function"&&t.externalCallback(n,r,i);if(n==="selected")for(var s=0;s<t.status.areaArray.length;s+=1)t.status.areaArray[s]===i?(t.ui.setProp(i,"color",t.selectedAreaColor),t.status.selected=s):t.ui.setProp(t.status.areaArray[s],"color",t.areaArgsTemplate.color);n==="held";if(n==="doubletap"){var o=t.ui.getElement(i),u=o.values.xOffset,a=o.values.width,f=e.GenericUtils.clone(t.areaArgsTemplate);f.ID="area"+t.status.nextNumber++,f.xOffset=r[0],f.width=a-(r[0]-u),f.height=o.height,f.yOffset=o.values.yOffset,o.values.width=r[0]-u;var l=new e.Area(f);t.ui.addElement(l),t.status.areaArray.splice(t.status.selected+1,0,f.ID)}t.ui.refresh()}},this.clearAreas=function(){for(var e=0;e<this.status.areaArray.length;e+=1)this.ui.removeElement(this.status.areaArray[e]);this.status.areaArray=[],this.status.selected=null,this.ui.refresh()},this.addArea=function(t,n){console.log("Adding an area");var r,i=e.GenericUtils.clone(this.areaArgsTemplate);i.width=t||i.width,i.height=n||i.height,i.ID="area"+this.status.nextNumber++;var s=new e.Area(i);if(this.status.areaArray.length!==0){r=this.ui.getElement(this.status.areaArray[this.status.areaArray.length-1]);var o=r.values.xOffset,u=r.values.width;s.values.xOffset=o+u}this.ui.addElement(s),this.status.areaArray.push(i.ID),this.ui.refresh()},this.removeArea=function(){var e;this.status.selected!==null},this.ui=t.ui,this.plugin_canvas=t.canvas,this.status={"areaArray":[],"selected":null,"nextNumber":0},this.Z_OFFSET=t.zOffset||0,this.width=t.width||t.canvas.width,this.height=t.height||t.canvas.height,this.lastCalculatedPoint=[],this.selectedAreaColor=t.selectedAreaColor||"red",this.externalCallback=t.callback,this.areaArgsTemplate={"ID":"","top":Math.floor(this.height/2),"left":0,"width":t.defaultWidth||Math.floor(this.height/10),"height":t.defaultHeight||Math.floor(this.height/2),"thickness":t.thickness||5,"color":t.color||"black","borders":t.borders||{"top":!0,"bottom":!0,"right":!0,"left":!0},"move":t.move||"x","dragBorders":{"top":!0,"bottom":!1,"right":!0,"left":!0},"xMonotone":!0,"yMonotone":!0,"isListening":t.isListening||!0,"transparency":t.transparency||.8,"onValueSet":this.callback()}},r=function(t){this.setVisible=function(){var e,t;arguments.length===1?(e=arguments[0],this.ui.setVisible("tempArea",e),this.ui.setVisible("selectBar",e)):arguments.length===2&&(t=arguments[0],e=arguments[1],this.ui.setVisible(t,e))},this.setTransparency=function(e){this.areaArgsTemplate.transparency=e,this.barArgs.transparency=e;var t=this.ui.getElement("selectBar");t.transparency=e;var n=this.ui.getElement("tempArea");n.transparency=e},this.setzIndex=function(e){this.zIndex=e,this.ui.setZIndex("tempArea",e),this.ui.setZIndex("selectBar",e+1)},this.setListening=function(e){this.ui.setListening("tempArea",e),this.ui.setListening("selectBar",e)},this.callback=function(){var t=this;return function(n,r,i){console.log("Element: ",i,". onValueSet callback: slot is ",n," and value is ",r," while that is ",t);var s;if(n==="dragStart"){console.log("Storing dragStart value ",r),t.dragStart=r;if(t.areaElement===null){t.ui.isElement(t.areaArgsTemplate.ID)&&t.ui.removeElement(t.areaArgsTemplate.ID);var o=e.GenericUtils.clone(t.areaArgsTemplate);t.areaElement=new e.Area(o)}t.areaElement.values.xOffset=t.dragStart[0],t.areaElement.values.width=0,t.selectStart=t.dragStart[0],t.selectWidth=0,t.ui.addElement(t.areaElement,{"zIndex":this.zIndex})}n==="barPos"&&(t.dragStart===null&&t.areaElement===null&&t.ui.isElement(t.areaArgsTemplate.ID)&&t.ui.removeElement(t.areaArgsTemplate.ID),t.areaElement!==null&&(s=r[0]-t.dragStart[0],t.areaElement.values.width=s,t.selectWidth=s)),n==="dragEnd"&&t.areaElement!==null&&(s=r[0]-t.dragStart[0],t.areaElement.values.width=s,t.selectWidth=s,t.dragStart=null,t.areaElement=null),typeof t.externalCallback=="function"&&t.externalCallback(n,r,i),t.ui.refresh()}},this.ui=t.ui,this.plugin_canvas=t.canvas,this.areaElement=null,this.zIndex=t.zIndex||0,this.width=t.width||t.canvas.width,this.height=t.height||t.canvas.height,this.externalCallback=t.callback;var n=this.callback();this.areaArgsTemplate={"ID":"tempArea","top":0,"left":0,"width":t.defaultWidth||this.width,"height":t.defaultHeight||this.height,"thickness":t.areaThickness||2,"color":t.areaColor||"black","borderColor":t.areaBorderColor||"gray","borders":{"top":!1,"bottom":!1,"right":!1,"left":!1},"move":t.move||"none","dragBorders":{"top":!1,"bottom":!1,"right":!1,"left":!1},"xMonotone":!0,"yMonotone":!0,"transparency":t.areaTransparency||.5,"isListening":t.isListening||!0,"onValueSet":n},t.areaThickness===0&&(areaArgsTemplate.thickness=0),this.barArgs={"ID":"selectBar","left":0,"top":0,"thickness":t.barThickness||2,"height":this.height,"width":this.width,"onValueSet":n,"barColor":t.barColor||"red","transparency":t.barTransparency||.8,"isListening":t.isListening||!0},this.ui.addElement(new e.Bar(this.barArgs),{"zIndex":this.zIndex+1}),this.ui.refresh()};e.ENGINE={},e.ENGINE.engineFactory=function(e,t){function n(e){this.reset=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},this.canvas=e,this.context=e.getContext("2d"),this.type="CANVAS2D",this.getContext=function(){return this.context},this.getCanvas=function(){return this.canvas}}switch(e){case"CANVAS2D":if(t.target!==undefined)return new n(t.target);throw"Engine: args is undefined";break;case"ANOTHERTYPE":throw"Engine type not recognized: "+e;default:throw"Engine type not recognized: "+e}};var s=window.CanvasRenderingContext2D&&CanvasRenderingContext2D.prototype;s.lineTo&&(s.dashedLine=function(e,t,n,r,i){i||(i=[10,5]),this.save();var s=n-e,o=r-t,u=Math.sqrt(s*s+o*o),a=Math.atan2(o,s);this.translate(e,t),this.moveTo(0,0),this.rotate(a);var f=i.length,l=0,c=!0;e=0;while(u>e)e+=i[l++%f],e>u&&(e=u),c?this.lineTo(e,0):this.moveTo(e,0),c=!c;this.restore()}),e.OSC={},e.OSC.Message=function(t){this.address=t,this.typetags="",this.args=[];for(var n=1;n<arguments.length;n++){var r=arguments[n];switch(typeof r){case"object":if(!r.typetag)throw new Error("don't know how to encode object "+r);this.typetags+=r.typetag,this.args.push(r);break;case"number":Math.floor(r)==r?(this.typetags+=e.OSC.TInt.prototype.typetag,this.args.push(new e.OSC.TInt(Math.floor(r)))):(this.typetags+=e.OSC.TFloat.prototype.typetag,this.args.push(new e.OSC.TFloat(r)));break;case"string":this.typetags+=e.OSC.TString.prototype.typetag,this.args.push(new e.OSC.TString(r));break;default:throw new Error("don't know how to encode "+r)}}},e.OSC.Message.prototype={"toBinary":function(){var t=new e.OSC.TString(this.address),n=[],r=[];r=t.encode(),n=n.concat(r);if(this.typetags){var i=new e.OSC.TString(","+this.typetags);r=i.encode(),n=n.concat(r);for(var s=0;s<this.args.length;s++)r=this.args[s].encode(),n=n.concat(r)}return n}},e.OSC.Bundle=function(t,n){e.OSC.Message.call(this,t),this.timetag=n||0},e.OSC.Bundle.prototype.append=function(t){var n;if(t instanceof Message)n=new e.OSC.TBlob(t.toBinary());else{var r=new e.OSC.Message(this.address);typeof t=="Object"?(t.addr&&(r.address=t.addr),t.args&&r.append.apply(t.args)):r.append(t),n=new e.OSC.TBlob(r.toBinary())}this.message+=n,this.typetags+="b"},e.OSC.Bundle.prototype.toBinary=function(){var t=new e.OSC.TString("#bundle");return t=t.concat(new e.OSC.TTimeTag(this.timetag)),t=t.concat(this.message),t},e.OSC.Encoder=function(){},e.OSC.Encoder.prototype={"encode":function(){var t;if(arguments[0].toBinary)t=arguments[0].toBinary();else{var n={};e.OSC.Message.apply(n,arguments),t=e.OSC.Message.prototype.toBinary.call(n)}return t}},e.OSC.ShortBuffer=function(e,t,n){this.type="ShortBuffer";var r="buffer [";for(var i=0;i<t.length;i++)i&&(r+=", "),r+=t.charCodeAt(i);r+="] too short for "+e+", "+n+" bytes required",this.message=r},e.OSC.TString=function(e){this.value=e},e.OSC.TString.prototype={"typetag":"s","decode":function(e){var t=0;while(e[t]&&t<e.length)t++;if(t==e.length)throw Error("OSC string not null terminated");this.value=String.fromCharCode.apply(null,e.slice(0,t));var n=parseInt(Math.ceil((t+1)/4)*4,10);return e.slice(n)},"encode":function(){var e=Math.ceil((this.value.length+1)/4,10)*4,t=new Array(e);return Struct.PackTo(">"+e+"s",t,0,[this.value])}},e.OSC.TInt=function(e){this.value=e},e.OSC.TInt.prototype={"typetag":"i","decode":function(e){if(e.length<4)throw new ShortBuffer("int",e,4);return this.value=Struct.Unpack(">i",e.slice(0,4))[0],e.slice(4)},"encode":function(){var e=new Array(4);return Struct.PackTo(">i",e,0,[this.value])}},e.OSC.TTime=function(e){this.value=e},e.OSC.TTime.prototype={"typetag":"t","decode":function(e){if(e.length<8)throw new ShortBuffer("time",e,8);return this.value=Struct.Unpack(">LL",e.slice(0,8))[0],e.slice(8)},"encode":function(e,t){return Struct.PackTo(">LL",e,t,this.value)}},e.OSC.TFloat=function(e){this.value=e},e.OSC.TFloat.prototype={"typetag":"f","decode":function(e){if(e.length<4)throw new ShortBuffer("float",e,4);return this.value=Struct.Unpack(">f",e.slice(0,4))[0],e.slice(4)},"encode":function(){var e=new Array(4);return Struct.PackTo(">f",e,0,[this.value])}},e.OSC.TBlob=function(e){this.value=e},e.OSC.TBlob.prototype={"typetag":"b","decode":function(e){var t=Struct.Unpack(">i",e.slice(0,4))[0],n=parseInt(Math.ceil(t/4)*4,10)+4;return this.value=e.slice(4,t+4),e.slice(n)},"encode":function(e,t){var n=Math.ceil(this.value.length/4,10)*4;return Struct.PackTo(">i"+n+"s",e,t,[n,this.value])}},e.OSC.TDouble=function(e){this.value=e},e.OSC.TDouble.prototype={"typetag":"d","decode":function(e){if(e.length<8)throw new ShortBuffer("double",e,8);return this.value=Struct.Unpack(">d",e.slice(0,8))[0],e.slice(8)},"encode":function(e,t){return Struct.PackTo(">d",e,t,[this.value])}},e.OSC.tagToConstructor={"i":function(){return new e.OSC.TInt},"f":function(){return new e.OSC.TFloat},"s":function(){return new e.OSC.TString},"b":function(){return new e.OSC.TBlob},"d":function(){return new e.OSC.TDouble}},e.OSC.decodeBundle=function(t){var n=[],r={"time":null,"args":[]},i=new e.OSC.TTime;t=i.decode(t),r.time=i.value;while(t.length>0){var s=new e.OSC.TInt;t=s.decode(t);var o=e.OSC.decode(t.slice(0,s.value));r.args.push(o),t=t.slice(s.value)}return n.push(r),n},e.OSC.decode=function(t){var n=[],r=new e.OSC.TString;t=r.decode(t),n.push(r.value);if(r.value==="#bundle")return e.OSC.decodeBundle(t);if(t.length>0){var i=new e.OSC.TString;t=i.decode(t),i=i.value;if(i[0]!=",")throw"invalid type tag in incoming OSC message, must start with comma";for(var s=1;s<i.length;s++){var o=e.OSC.tagToConstructor[i[s]];if(!o)throw"Unsupported OSC type tag "+i[s]+" in incoming message";var u=o();t=u.decode(t),n.push(u.value)}}return n},e.OSC.Decoder=function(){},e.OSC.Decoder.prototype.decode=function(t){var n=e.OSC.decode(t);try{if(n)return n}catch(r){console.log("can't decode incoming message: "+r.message)}},e.OSCClient=function(e,t){this.oscHandler=t,this.clientID=e.clientID,this.oscCallback=e.oscCallback,this.isListening=e.isListening||!0},e.OSCClient.prototype.sendOSC=function(e,t){var n=this.oscHandler.OSCEncoder.encode(e),r=t;typeof t=="undefined"&&(r={"sendRemote":!0,"sendLocal":!0}),r.sendRemote!==!1&&this.oscHandler.proxyOK===!0&&this.oscHandler.socket.emit("osc",{"osc":n}),r.sendLocal!==!1&&this.oscHandler.sendLocalMessage.apply(this.oscHandler,[n,this.clientID])},e.OSCHandler=function(t,n){this.localClients={},this.OSCDecoder=new e.OSC.Decoder,this.OSCEncoder=new e.OSC.Encoder,this.udpServers=n||null,this.proxyServer=t||null,this.proxyOK=!1,this.proxyConnected=!1;if(this.proxyServer!==null){try{this.socket=io.connect("http://"+this.proxyServer.host+":"+this.proxyServer.port)}catch(r){console.error("io.connect failed. No proxy server?");return}this.socket.on("admin",function(e){console.log("Received an admin message: ",e),this.proxyOK=!0,this.udpServers!==null&&this.socket.emit("admin",{"type":"udphosts","content":this.udpServers})}.bind(this)),this.socket.on("osc",function(e){var t=Array.prototype.slice.call(e.osc,0);console.log("received osc from the server: "+t),this.sendLocalMessage(t)}.bind(this)),this.socket.on("disconnect",function(e){console.log("socket disconnected"),this.proxyConnected=!1,this.proxyOK=!1}.bind(this)),this.socket.on("connect",function(e){console.log("socket connected"),this.proxyConnected=!0}.bind(this))}},e.OSCHandler.prototype.registerClient=function(t){return this.localClients[t.clientID]=new e.OSCClient(t,this),this.localClients[t.clientID]},e.OSCHandler.prototype.unregisterClient=function(e){delete this.localClients[e]},e.OSCHandler.prototype.sendLocalMessage=function(e,t){var n=this.OSCDecoder.decode(e);console.log("decoded OSC = "+n);for(var r in this.localClients)if(this.localClients.hasOwnProperty(r)){var i=this.localClients[r];i.clientID!==t&&i.isListening&&typeof i.oscCallback=="function"&&i.oscCallback(n)}},e.loadImageArray=function(e){this.onCompletion=function(){if(typeof this.onComplete=="function"){var e=this.pollStatus(),t={"imagesArray":this.imagesArray,"status":e};this.onComplete(t)}return},this.onLoad=function(e){return function(){e.objectsLoaded+=1,e.check(e.onSingle,this)}},this.onError=function(e){return function(){e.objectsError+=1,e.check(e.onErr,this)}},this.check=function(e,t){if(typeof e=="function"){var n=this.pollStatus();e({"obj":t,"status":n})}this.objectsLoaded+this.objectsError===this.objectsTotal&&this.onCompletion()},this.pollStatus=function(){return{"id":this.ID,"loaded":this.objectsLoaded,"error":this.objectsError,"total":this.objectsTotal}},this.ID=e.ID,this.onComplete=e.onComplete,this.onSingle=e.onSingle,this.onErr=e.onError,this.objectsLoaded=0,this.objectsError=0,this.objectsTotal=e.imageNames.length,this.imagesArray=[];for(var t=0;t<this.objectsTotal;t+=1)this.imagesArray[t]=new Image,this.imagesArray[t].onload=this.onLoad(this),this.imagesArray[t].onerror=this.onError(this),this.imagesArray[t].src=e.imageNames[t]},e.loadMultipleImages=function(e){this.loadingManager=function(){var e=this;return function(t){var n=t;if(e.loaders[n.status.id]===undefined)throw new Error("in loaders, "+n.status.id+" is undefined");e.loaders[n.status.id].done=!0,e.loaders[n.status.id].images=e.loaders[n.status.id].imageArray.imagesArray,typeof e.onSingleArray=="function"&&e.onSingleArray(t);for(var r in e.loaders)if(e.loaders.hasOwnProperty(r)&&e.loaders[r].done!==!0)return;e.onComplete(e.loaders)}},this.errorManager=function(){var e=this;return function(t){typeof e.onError=="function"&&e.onError(t)}},this.singleManager=function(){var e=this;return function(t){typeof e.onSingle=="function"&&e.onSingle(t)}},this.multipleImages=e.multipleImages,this.onComplete=e.onComplete,this.onError=e.onError,this.onSingle=e.onSingle,this.onSingleArray=e.onSingleArray,this.loaders={};for(var t=0;t<this.multipleImages.length;t+=1){var n={};n.imageArray=new loadImageArray({"ID":this.multipleImages[t].ID,"imageNames":this.multipleImages[t].imageNames,"onComplete":this.loadingManager(),"onError":this.errorManager(),"onSingle":this.singleManager()}),n.done=!1,this.loaders[this.multipleImages[t].ID]=n}},e.GenericUtils={},e.GenericUtils.clone=function(t){var n;if(null===t||"object"!=typeof t)return t;if(t instanceof Date)return n=new Date,n.setTime(t.getTime()),n;if(t instanceof Array){n=[];for(var r=0,i=t.length;r<i;++r)n[r]=e.GenericUtils.clone(t[r]);return n}if(t instanceof Object){n={};for(var s in t)t.hasOwnProperty(s)&&(n[s]=e.GenericUtils.clone(t[s]));return n}throw new Error("Unable to copy obj! Its type isn't supported.")},e.MathUtils={},e.MathUtils.linearRange=function(e,t,n,r,i){var s=(i-e)*(r-n)/(t-e)+n;return s},e.MathUtils.distance=function(e,t,n,r){return Math.sqrt(Math.pow(e-n,2)+Math.pow(t-r,2))},e.MathUtils.fact_table=[1,1,2,6,24,120,720,5040,40320,362880,3628800,39916800,479001600,6227020800,87178291200,1307674368e3,20922789888e3,355687428096e3,6402373705728e3,0x1b02b9306890000,243290200817664e4,5109094217170944e4,0x3ceea4c2b3e0d80000,2.585201673888498e22,6.204484017332394e23,1.5511210043330986e25,4.0329146112660565e26,1.0888869450418352e28,3.0488834461171387e29,8.841761993739702e30,2.6525285981219107e32,8.222838654177922e33,2.631308369336935e35,8.683317618811886e36,2.9523279903960416e38,1.0333147966386145e40,3.7199332678990125e41,1.3763753091226346e43,5.230226174666011e44,2.0397882081197444e46,8.159152832478977e47,3.345252661316381e49,1.40500611775288e51,6.041526306337383e52,2.658271574788449e54,1.1962222086548019e56,5.502622159812089e57,2.5862324151116818e59,1.2413915592536073e61,6.082818640342675e62,3.0414093201713376e64,1.5511187532873822e66,8.065817517094388e67,4.2748832840600255e69,2.308436973392414e71,1.2696403353658276e73,7.109985878048635e74,4.0526919504877214e76,2.3505613312828785e78,1.3868311854568984e80,8.32098711274139e81,5.075802138772248e83,3.146997326038794e85,1.98260831540444e87,1.2688693218588417e89,8.247650592082472e90,5.443449390774431e92,3.647111091818868e94,2.4800355424368305e96,1.711224524281413e98,1.1978571669969892e100,8.504785885678623e101,6.1234458376886085e103,4.4701154615126844e105,3.307885441519386e107,2.48091408113954e109,1.8854947016660504e111,1.4518309202828587e113,1.1324281178206297e115,8.946182130782976e116,7.156945704626381e118,5.797126020747368e120,4.753643337012842e122,3.945523969720659e124,3.314240134565353e126,2.81710411438055e128,2.4227095383672734e130,2.107757298379528e132,1.8548264225739844e134,1.650795516090846e136,1.4857159644817615e138,1.352001527678403e140,1.2438414054641308e142,1.1567725070816416e144,1.087366156656743e146,1.032997848823906e148,9.916779348709496e149,9.619275968248212e151,9.426890448883248e153,9.332621544394415e155,9.332621544394415e157],e.MathUtils.fact_lookup=function(t){if(0<t<=100)return e.MathUtils.fact_table[t];var n=1;for(var r=2;r<=t;r++)n*=r;return n},e.CanvasUtils={},e.CanvasUtils.drawRotate=function(e,t){e.save(),e.translate(t.x+t.image.width/2,t.y+t.image.height/2),e.rotate(t.rot),e.translate(-(t.image.width/2)-t.x,-(t.image.height/2)-t.y),e.drawImage(t.image,t.x,t.y),e.restore()};if(typeof define=="function"&&define.amd)console.log("AMD detected, setting define"),define(["hammerjs"],function(t){return console.log("KievII: returning K2 object inside the define (AMD detected)"),e.Hammer=t,e});else{console.log("KievII: setting window.K2 (no AMD)");if(typeof window.Hammer=="undefined")throw"Hammer.js needed!";e.Hammer=window.Hammer,window.kievII=window.K2=e}})();